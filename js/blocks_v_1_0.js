var blocks=blocks||{};blocks.boot=function(t){},blocks.boot.prototype={preload:function(){},create:function(){this.stage.backgroundColor="#f8f8f8",this.physics.startSystem(Phaser.Physics.ARCADE),this.game.device.desktop||(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.minWidth=138,this.scale.minHeight=146,this.scale.maxWidth=1380,this.scale.maxHeight=1460,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.setScreenSize(!0)),this.scale.pageAlignHorizontally=!0,this.state.start("load")}};var blocks=blocks||{};blocks.load=function(t){},blocks.load.prototype={preload:function(){this.load.image("centerblock","assets/centerblock.png"),this.load.image("dummy","assets/dummy.png"),this.load.image("bg","assets/bg.png");for(var t,i=0;i<36;i++)t=i+1,this.load.image("block"+blocks.padNumber(t),"assets/block"+blocks.padNumber(t)+".png");for(var i=0;i<9;i++)t=i+1,this.load.image("howtoplay"+blocks.padNumber(t),"assets/howtoplay"+blocks.padNumber(t)+".png")},create:function(){this.state.start("menu")}};var blocks=blocks||{};blocks.menu=function(t){},blocks.menu.prototype={create:function(){this.add.image(0,0,"bg"),this.blockSize=30,this.directions=["top","right","down","left"],this.chainsTitle=[[1,0],[2,0],[4,0],[6,0],[9,0],[12,0],[14,0],[16,0],[18,0],[19,0],[20,0],[0,1],[4,1],[6,1],[8,1],[10,1],[12,1],[14,1],[15,1],[16,1],[18,1],[0,2],[4,2],[5,2],[6,2],[8,2],[9,2],[10,2],[12,2],[14,2],[16,2],[20,2],[1,3],[2,3],[4,3],[6,3],[8,3],[10,3],[12,3],[14,3],[16,3],[18,3],[19,3],[20,3]],this.alphabet={A:[[1],[0,2],[0,1,2],[0,2],[0,2]],B:[[0,1],[0,2],[0,1],[0,2],[0,1]],C:[[1],[0,2],[0],[0,2],[1]],D:[[0,1],[0,2],[0,2],[0,2],[0,1]],E:[[0,1,2],[0],[0,1,2],[0],[0,1,2]],F:[[0,1,2],[0],[0,1],[0],[0]],G:[[1],[0,2],[0],[0,1,2],[1,2]],H:[[0,2],[0,2],[0,1,2],[0,2],[0,2]],I:[[1],[1],[1],[1],[1]],J:[[2],[2],[2],[0,2],[1]],K:[[0,2],[0,1],[0],[0,1],[0,2]],L:[[0],[0],[0],[0],[0,1,2]],M:[[0,2],[0,1,2],[0,1,2],[0,2],[0,2]],N:[[0,2],[0,1,2],[0,2],[0,2],[0,2]],O:[[1],[0,2],[0,2],[0,2],[1]],P:[[0,1],[0,2],[0,1],[0],[0]],Q:[[1],[0,2],[0,2],[0,1,2],[1,2]],R:[[0,1],[0,2],[0,1],[0,1],[0,2]],S:[[1,2],[0],[1],[2],[0,1]],T:[[0,1,2],[1],[1],[1],[1]],U:[[0,2],[0,2],[0,2],[0,2],[0,1,2]],V:[[0,2],[0,2],[0,2],[0,2],[1]],W:[[0,4],[0,4],[0,2,4],[0,2,4],[1,3]],X:[[0,2],[0,2],[1],[0,2],[0,2]],Y:[[0,2],[0,1,2],[1],[1],[1]],Z:[[0,1,2],[2],[1],[0],[0,1,2]]},this.alphabet[0]=[[1],[0,2],[0,2],[0,2],[1]],this.alphabet[1]=[[1],[0,1],[1],[1],[0,1,2]],this.alphabet[2]=[[0,1,2],[0,2],[2],[1],[0,1,2]],this.alphabet[3]=[[0,1,2],[2],[1,2],[2],[0,1,2]],this.alphabet[4]=[[0,2],[0,2],[0,1,2],[2],[2]],this.alphabet[5]=[[0,1,2],[0],[0,1,2],[2],[0,1,2]],this.alphabet[6]=[[0,1,2],[0],[0,1,2],[0,2],[0,1,2]],this.alphabet[7]=[[0,1,2],[2],[1],[1],[1]],this.alphabet[8]=[[0,1,2],[0,2],[0,1,2],[0,2],[0,1,2]],this.alphabet[9]=[[0,1,2],[0,2],[0,1,2],[2],[1]],this.alphabet["."]=[[],[],[],[],[1]],this.alphabet[":"]=[[],[1],[],[1],[]],this.alphabet[","]=[[],[],[],[],[1],[1]],this.alphabet["-"]=[[],[],[0,1,2],[],[]],this.alphabet["!"]=[[1],[1],[1],[],[1]],this.alphabet[">"]=[[0],[0,1],[0,1,2],[0,1],[0]],this.alphabet["<"]=[[2],[1,2],[0,1,2],[1,2],[2]],this.alphabet["/"]=[[2],[1],[1],[1],[0]],this.alphabet["["]=[[0,1],[0],[0],[0],[0,1]],this.alphabet["]"]=[[1,2],[2],[2],[2],[1,2]],this.titlePaddingX=Math.floor(this.game.width-21*this.blockSize)/2,this.titlePaddingY=Math.floor(this.game.height/5),this.imageBufferGroup=this.add.group(),this.imageGroup=this.add.group(),this.imageGroup2=this.add.group(),this.titleOverlay=this.add.bitmapData(this.game.width,1*this.game.height/4),this.titleOverlay.ctx.fillStyle="rgba(255, 255, 255, 0.85)",this.titleOverlay.ctx.fillRect(0,0,this.titleOverlay.width,this.titleOverlay.height),this.titleOverlaySprite=this.titleOverlay.addToWorld(0,this.titlePaddingY-this.titleOverlay.height/6,0,0),this.titleOverlaySprite.alpha=0,this.titleOverlaySprite.tweenAlpha=this.add.tween(this.titleOverlaySprite).to({alpha:1},1200).start(),this.titleGroup=this.add.group(),this.imageBufferGroup.createMultiple(20,"block01"),this.imageGroup.createMultiple(20,"block01"),this.imageGroup2.createMultiple(20,"block01"),this.titleGroup.createMultiple(44,"block01"),this.overlay=this.add.bitmapData(this.game.width,1*this.game.height/4),this.overlay.ctx.fillStyle="rgba(255, 255, 255, 0.85)",this.overlay.ctx.fillRect(0,0,this.overlay.width,this.overlay.height),this.overlaySprite=this.overlay.addToWorld(Math.floor(this.game.width/2),Math.floor(110+2*this.game.height/4),.5,.11),this.overlaySprite.alpha=0,this.overlaySprite.tweenAlpha=this.add.tween(this.overlaySprite).to({alpha:1},1200).start();var t=[5,6,8,9,10,16,29];for(this.number=!0;this.number===!0;){this.number=this.rnd.integerInRange(1,36);for(var i=0;i<t.length;i++)this.number===t[i]&&(this.number=!0)}this.textGroup=this.add.group(),this.blockTimer=this.game.time.create(!1),this.blockTimer.loop(450,function(){this.addBlock(0,!1)},this),this.blockTimer.start(),this.titleTimer=this.game.time.events.add(100,function(){this.addBlock(0,!0)},this);var e="how to play".toUpperCase(),s=[],h=.4,o=Math.floor((this.game.width-this.getTextLength(e)*this.blockSize*h)/2),n=Math.floor(100+2*this.game.height/4);this.howtoplayLock=!1,this.howtoplay=this.add.image(Math.floor((this.game.width-this.getTextLength(e)*this.blockSize*h)/2),Math.floor(100+2*this.game.height/4),"dummy"),this.howtoplay.width=this.getTextLength(e)*this.blockSize*h,this.howtoplay.height=5*this.blockSize*h,this.howtoplay.renderable=!1,this.howtoplay.inputEnabled=!1,this.howtoplay.events.onInputDown.add(this.howtoplayScreen,this),this.getIndices(e,s),this.typeText(e,s,o,n,h,"textGroup","howtoplay",null,0),e="new game".toUpperCase(),s=[],o=Math.floor((this.game.width-this.getTextLength(e)*this.blockSize*h)/2),n=Math.floor(200+2*this.game.height/4),this.newGameLock=!1,this.newgame=this.add.image(Math.floor((this.game.width-this.getTextLength(e)*this.blockSize*h)/2),Math.floor(200+2*this.game.height/4),"dummy"),this.newgame.width=this.getTextLength(e)*this.blockSize*h,this.newgame.height=5*this.blockSize*h,this.newgame.renderable=!1,this.newgame.inputEnabled=!1,this.newgame.events.onInputDown.add(this.newGame,this),this.getIndices(e,s),this.typeText(e,s,o,n,h,"textGroup","newgame",null,0),this.htpGroup=this.add.group(),this.htpPage=0,this.htpPagesTotal=9;for(var a,l,i=0;i<this.htpPagesTotal;i++)a=i+1,l=this.add.image(30,30,"howtoplay"+blocks.padNumber(a),0,this.htpGroup),l.width=l.width-60,l.height=l.height-60,l.renderable=!1;this.ngBD=this.add.bitmapData(this.game.width-100,this.game.height-100),this.ngBD.ctx.fillStyle="rgba(255, 255, 255, 0.73)",this.ngBD.ctx.fillRect(0,0,this.ngBD.width,this.ngBD.height),this.ngOverlay=this.ngBD.addToWorld(50,50),this.ngOverlay.renderable=!1,this.ngCustomLock=!1,blocks.ngCustom=!1},leftArrow:function(t,i,e,s,h,o,n){return function(){var a=this[t].indexOf(blocks[i]);a--,a<0&&(a=this[t].length-1),blocks[i]=this[t][a],n?this[e]="left"===n?Math.floor(this.game.width/3-this.getTextLength(blocks[i])*this.blockSize*this[h]/2):Math.floor(2*this.game.width/3-this.getTextLength(blocks[i])*this.blockSize*this[h]/2):this[e]=Math.floor((this.game.width-this.getTextLength(blocks[i])*this.blockSize*this[h])/2),this.changeBlockText(this[o],blocks[i],this[h],this[e],this[s])}.bind(this)},rightArrow:function(t,i,e,s,h,o,n){return function(){var a=this[t].indexOf(blocks[i]);a++,a>=this[t].length&&(a=0),blocks[i]=this[t][a],n?this[e]="left"===n?Math.floor(this.game.width/3-this.getTextLength(blocks[i])*this.blockSize*this[h]/2):Math.floor(2*this.game.width/3-this.getTextLength(blocks[i])*this.blockSize*this[h]/2):this[e]=Math.floor((this.game.width-this.getTextLength(blocks[i])*this.blockSize*this[h])/2),this.changeBlockText(this[o],blocks[i],this[h],this[e],this[s])}.bind(this)},changeBlockText:function(t,i,e,s,h){t.callAll("kill");var o,n,a,l,c=0;i=i.toUpperCase();for(var r=0;r<i.length;r++){o=this.alphabet[i[r]];for(var g=0;g<o.length;g++)for(var d=0;d<o[g].length;d++)a=s+o[g][d]*e*this.blockSize+c,l=h+g*e*this.blockSize,n=t.getFirstDead(),n?(n.key="block"+blocks.padNumber(this.number),n.loadTexture(n.key),n.reset(a,l)):n=this.add.image(a,l,"block"+blocks.padNumber(this.number),0,t),n.scale.set(e);c+="W"!==i[r]?this.blockSize*e*4:this.blockSize*e*6}},howtoplayScreen:function(){if(!this.howtoplayLock){this.howtoplay.inputEnabled=!1,this.newgame.inputEnabled=!1,this.nextButton=this.nextButton||this.add.group();var t=">".toUpperCase(),i=[],e=.3,s=Math.floor(this.game.width-3*this.blockSize*e),h=Math.floor(this.game.height/2-2.5*this.blockSize*e);this.getIndices(t,i),this.typeText(t,i,s,h,e,"nextButton","nextButton",function(){this.htpPage<this.htpPagesTotal-1?(this.htpGroup.getChildAt(this.htpPage).renderable=!1,this.htpGroup.getChildAt(++this.htpPage).renderable=!0):(this.htpGroup.getChildAt(this.htpPage).renderable=!1,this.htpGroup.getChildAt(this.htpPage=0).renderable=!0)}.bind(this),0),this.backButton=this.backButton||this.add.group(),t="<".toUpperCase(),i=[],s=0,h=Math.floor(this.game.height/2-2.5*this.blockSize*e),this.getIndices(t,i),this.typeText(t,i,s,h,e,"backButton","backButton",function(){this.htpPage>0?(this.htpGroup.getChildAt(this.htpPage).renderable=!1,this.htpGroup.getChildAt(--this.htpPage).renderable=!0):(this.htpGroup.getChildAt(this.htpPage).renderable=!1,this.htpGroup.getChildAt(this.htpPage=this.htpPagesTotal-1).renderable=!0)}.bind(this),0),t="back to menu".toUpperCase(),i=[],e=.2,s=Math.floor(this.game.width/2-this.getTextLength(t)*this.blockSize*e/2),h=Math.floor(this.game.height-5*this.blockSize*e),this.cancelOverlay=this.cancelOverlay||this.add.bitmapData(this.getTextLength(t)*this.blockSize*e+this.blockSize*e,5*this.blockSize*e),this.cancelOverlay.ctx.fillStyle="rgba(255, 255, 255, 0.85)",this.cancelOverlay.ctx.fillRect(0,0,this.cancelOverlay.width,this.cancelOverlay.height),this.cancelButtonDummy=this.cancelButtonDummy||this.cancelOverlay.addToWorld(Math.floor(this.game.width/2-this.getTextLength(t)*this.blockSize*e/2-this.blockSize*e),Math.floor(this.game.height-5*this.blockSize*e)),this.cancelButtonDummy.inputEnabled=!1,this.cancelButtonDummy.events.onInputDown.add(function(){this.htpGroup.setAll("renderable",!1),this.cancelButton.setAll("renderable",!1),this.cancelButtonDummy.renderable=!1,this.cancelButtonDummy.inputEnabled=!1,this.backButton.setAll("renderable",!1),this.backButton.setAll("inputEnabled",!1),this.nextButton.setAll("renderable",!1),this.nextButton.setAll("inputEnabled",!1),this.howtoplay.inputEnabled=!0,this.newgame.inputEnabled=!0,this.htpPage=0},this),this.cancelButton=this.cancelButton||this.add.group(),this.getIndices(t,i),this.typeText(t,i,s,h,e,"cancelButton","cancelButtonDummy",null,0),this.cancelButtonDummy.renderable=!0,this.htpGroup.getChildAt(0).renderable=!0}},newGame:function(){if(!this.newGameLock){this.ngOverlay.height=this.ngBD.height,this.ngOverlay.renderable=!0,this.howtoplay.inputEnabled=!1,this.newgame.inputEnabled=!1,this.howtoplayLock=!0,this.ngLabelScale=.24,this.ngTextScale=.2;var t,i;this.ml=this.ml||this.add.group(),this.mr=this.mr||this.add.group(),this.modeText=this.modeText||this.add.group(),this.modeLabel=this.modeLabel||this.add.group(),this.modes=["normal","tetris","custom"],blocks.gameMode=this.modes[0],t="game mode".toUpperCase(),i=[],this.ngModeX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngModeY=Math.floor(100),this.getIndices(t,i),this.typeText(t,i,this.ngModeX,this.ngModeY,this.ngLabelScale,"modeLabel",!1,null,0),t=blocks.gameMode.toUpperCase(),i=[],this.ngModeTX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngTextScale)/2),this.ngModeTY=Math.floor(160),this.getIndices(t,i),this.typeText(t,i,this.ngModeTX,this.ngModeTY,this.ngTextScale,"modeText",!1,null,0),t="<".toUpperCase(),i=[],this.ngModeLAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngModeLAY=Math.floor(160),this.getIndices(t,i),this.typeText(t,i,this.ngModeLAX,this.ngModeLAY,this.ngLabelScale,"ml","ml",this.leftArrow("modes","gameMode","ngModeTX","ngModeTY","ngTextScale","modeText",!1),3e3),t=">".toUpperCase(),i=[],this.ngModeRAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngModeRAY=Math.floor(160),this.getIndices(t,i),this.typeText(t,i,this.ngModeRAX,this.ngModeRAY,this.ngLabelScale,"mr","mr",this.rightArrow("modes","gameMode","ngModeTX","ngModeTY","ngTextScale","modeText",!1),3e3),this.dl=this.dl||this.add.group(),this.dr=this.dr||this.add.group(),this.diffText=this.diffText||this.add.group(),this.diffLabel=this.diffLabel||this.add.group(),this.difficulties=["easy","normal","challenge"],blocks.difficulty=this.difficulties[1],t="difficulty".toUpperCase(),i=[],this.ngDiffLX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngDiffLY=Math.floor(230),this.getIndices(t,i),this.typeText(t,i,this.ngDiffLX,this.ngDiffLY,this.ngLabelScale,"diffLabel",!1,null,0),t=blocks.difficulty.toUpperCase(),i=[],this.ngDiffTX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngTextScale)/2),this.ngDiffTY=Math.floor(290),this.getIndices(t,i),this.typeText(t,i,this.ngDiffTX,this.ngDiffTY,this.ngTextScale,"diffText",!1,null,0),t="<".toUpperCase(),i=[],this.ngDiffLAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngDiffLAY=Math.floor(290),this.getIndices(t,i),this.typeText(t,i,this.ngDiffLAX,this.ngDiffLAY,this.ngLabelScale,"dl","dl",this.leftArrow("difficulties","difficulty","ngDiffTX","ngDiffTY","ngTextScale","diffText",!1),3e3),t=">".toUpperCase(),i=[],this.ngDiffRAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngDiffRAY=Math.floor(290),this.getIndices(t,i),this.typeText(t,i,this.ngDiffRAX,this.ngDiffRAY,this.ngLabelScale,"dr","dr",this.rightArrow("difficulties","difficulty","ngDiffTX","ngDiffTY","ngTextScale","diffText",!1),3e3),this.sl=this.sl||this.add.group(),this.sr=this.sr||this.add.group(),this.sizeText=this.sizeText||this.add.group(),this.sizeLabel=this.sizeLabel||this.add.group(),this.sizes=["9x9","15x15","21x21"],blocks.size=this.sizes[0],t="grid size".toUpperCase(),i=[],this.ngSizeLabelX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngSizeLabelY=Math.floor(360),this.getIndices(t,i),this.typeText(t,i,this.ngSizeLabelX,this.ngSizeLabelY,this.ngLabelScale,"sizeLabel",!1,null,0),t=blocks.size.toUpperCase(),i=[],this.ngSizeTX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngTextScale)/2),this.ngSizeTY=Math.floor(420),this.getIndices(t,i),this.typeText(t,i,this.ngSizeTX,this.ngSizeTY,this.ngTextScale,"sizeText",!1,null,0),t="<".toUpperCase(),i=[],this.ngSizeLAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngSizeLAY=Math.floor(420),this.getIndices(t,i),this.typeText(t,i,this.ngSizeLAX,this.ngSizeLAY,this.ngLabelScale,"sl","sl",this.leftArrow("sizes","size","ngSizeTX","ngSizeTY","ngTextScale","sizeText",!1),3e3),t=">".toUpperCase(),i=[],this.ngSizeRAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngSizeRAY=Math.floor(420),this.getIndices(t,i),this.typeText(t,i,this.ngSizeRAX,this.ngSizeRAY,this.ngLabelScale,"sr","sr",this.rightArrow("sizes","size","ngSizeTX","ngSizeTY","ngTextScale","sizeText",!1),3e3),this.ngReturn=this.ngReturn||this.add.group(),t="return".toUpperCase(),i=[],this.ngReturnX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngReturnY=Math.floor(590),this.ngReturnDummy=this.ngReturnDummy||this.add.image(this.ngReturnX,this.ngReturnY,"dummy"),this.ngReturnDummy.width=this.getTextLength(t)*this.blockSize*this.ngLabelScale,this.ngReturnDummy.height=5*this.blockSize*this.ngLabelScale,this.ngReturnDummy.renderable=!1,this.ngReturnDummy.inputEnabled=!1,this.ngReturnDummy.events.onInputDown.add(function(){blocks.gameMode="normal",blocks.difficulty="normal",blocks.size="9x9",this.ngOverlay.renderable=!1,this.ngReturnDummy.renderable=!1,this.ngReturnDummy.inputEnabled=!1,this.ngReturnDummy.events.onInputDown.removeAll(),this.ngSelectDummy.renderable=!1,this.ngSelectDummy.inputEnabled=!1,this.ngSelectDummy.events.onInputDown.removeAll();for(var t=0;t<this.ngGroups.length;t++)this.ngGroups[t].callAll("kill"),this.ngGroups[t].callAll("events.onInputDown.removeAll","events.onInputDown"),this.ngGroups[t].setAll("inputEnabled",!1);this.howtoplay.inputEnabled=!0,this.newgame.inputEnabled=!0,this.howtoplayLock=!1},this),this.getIndices(t,i),this.typeText(t,i,this.ngReturnX,this.ngReturnY,this.ngLabelScale,"ngReturn","ngReturnDummy",null,0),this.ngSelect=this.ngSelect||this.add.group(),t="select".toUpperCase(),i=[],this.ngSelectX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngSelectY=Math.floor(520),this.ngSelectDummy=this.ngSelectDummy||this.add.image(this.ngSelectX,this.ngSelectY,"dummy"),this.ngSelectDummy.width=this.getTextLength(t)*this.blockSize*this.ngLabelScale,this.ngSelectDummy.height=5*this.blockSize*this.ngLabelScale,this.ngSelectDummy.renderable=!1,this.ngSelectDummy.inputEnabled=!1,this.ngSelectDummy.events.onInputDown.add(function(){if("custom"!==blocks.gameMode)this.destroyNewGame(),this.ngCustomLock&&this.destroyCustomMenu(),this.state.start("game");else{this.ngSelectDummy.renderable=!1,this.ngSelectDummy.inputEnabled=!1,this.ngSelectDummy.events.onInputDown.removeAll(),this.ngReturnDummy.renderable=!1,this.ngReturnDummy.inputEnabled=!1,this.ngReturnDummy.events.onInputDown.removeAll();for(var t=0;t<this.ngGroups.length;t++)this.ngGroups[t].callAll("kill"),this.ngGroups[t].callAll("events.onInputDown.removeAll","events.onInputDown"),this.ngGroups[t].setAll("inputEnabled",!1);this.ngCustomScreen()}},this),this.getIndices(t,i),this.typeText(t,i,this.ngSelectX,this.ngSelectY,this.ngLabelScale,"ngSelect","ngSelectDummy",null,0),this.ngGroups=[this.ml,this.mr,this.modeText,this.modeLabel,this.dl,this.dr,this.diffText,this.diffLabel,this.sl,this.sr,this.sizeText,this.sizeLabel,this.ngReturn,this.ngSelect]}},destroyNewGame:function(){this.ngSelectDummy.events.onInputDown.removeAll(),this.ngReturnDummy.events.onInputDown.removeAll(),this.ngSelectDummy.destroy(!0),this.ngReturnDummy.destroy(!0),this.ngSelectDummy=void 0,this.ngReturnDummy=void 0;for(var t=0;t<this.ngGroups.length;t++)this.ngGroups[t].callAll("events.onInputDown.removeAll","events.onInputDown"),this.ngGroups[t].destroy(!0),this.ngGroups[t]=void 0;this.ml=void 0,this.mr=void 0,this.modeText=void 0,this.modeLabel=void 0,this.dl=void 0,this.dr=void 0,this.diffText=void 0,this.diffLabel=void 0,this.sl=void 0,this.sr=void 0,this.sizeText=void 0,this.sizeLabel=void 0,this.ngReturn=void 0,this.ngSelect=void 0},ngCustomScreen:function(){this.ngCustomLock=!0,blocks.ngCustom=!0,this.ngOverlay.height=Math.floor(1.07*this.ngBD.height),this.ngLabelScale=.1,this.ngTextScale=.08;var t,i;this.ngcML=this.ngcML||this.add.group(),this.ngcMR=this.ngcMR||this.add.group(),this.ngcMText=this.ngcMText||this.add.group(),this.ngcMLabel=this.ngcMLabel||this.add.group(),t="game mode".toUpperCase(),i=[],this.ngcMX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcMY=Math.floor(70),this.getIndices(t,i),this.typeText(t,i,this.ngcMX,this.ngcMY,this.ngLabelScale,"ngcMLabel",!1,null,0),this.ngcModes=["normal","tetris"],blocks.ngcMode="normal",t=blocks.ngcMode.toUpperCase(),i=[],this.ngcMTX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcMTY=Math.floor(100+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcMTX,this.ngcMTY,this.ngTextScale,"ngcMText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcMLAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcMLAY=Math.floor(100),this.getIndices(t,i),this.typeText(t,i,this.ngcMLAX,this.ngcMLAY,this.ngLabelScale,"ngcML","ngcML",this.leftArrow("ngcModes","ngcMode","ngcMTX","ngcMTY","ngTextScale","ngcMText","left"),2e3),t=">".toUpperCase(),i=[],this.ngcMRAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcMRAY=Math.floor(100),this.getIndices(t,i),this.typeText(t,i,this.ngcMRAX,this.ngcMRAY,this.ngLabelScale,"ngcMR","ngcMR",this.rightArrow("ngcModes","ngcMode","ngcMTX","ngcMTY","ngTextScale","ngcMText","left"),2e3),this.ngcSL=this.ngcSL||this.add.group(),this.ngcSR=this.ngcSR||this.add.group(),this.ngcSText=this.ngcSText||this.add.group(),this.ngcSLabel=this.ngcSLabel||this.add.group(),t="size".toUpperCase(),i=[],this.ngcSX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcSY=Math.floor(70),this.getIndices(t,i),this.typeText(t,i,this.ngcSX,this.ngcSY,this.ngLabelScale,"ngcSLabel",!1,null,0),this.ngcSizes=["9x9","11x11","13x13","15x15","17x17","19x19","21x21","23x23","25x25"],blocks.size="15x15",t=blocks.size.toUpperCase(),i=[],this.ngcSTX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcSTY=Math.floor(100+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcSTX,this.ngcSTY,this.ngTextScale,"ngcSText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcSLAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcSLAY=Math.floor(100),this.getIndices(t,i),this.typeText(t,i,this.ngcSLAX,this.ngcSLAY,this.ngLabelScale,"ngcSL","ngcSL",this.leftArrow("ngcSizes","size","ngcSTX","ngcSTY","ngTextScale","ngcSText","right"),2e3),t=">".toUpperCase(),i=[],this.ngcSRAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcSRAY=Math.floor(100),this.getIndices(t,i),this.typeText(t,i,this.ngcSRAX,this.ngcSRAY,this.ngLabelScale,"ngcSR","ngcSR",this.rightArrow("ngcSizes","size","ngcSTX","ngcSTY","ngTextScale","ngcSText","right"),2e3),this.ngcPL=this.ngcPl||this.add.group(),this.ngcPR=this.ngcPr||this.add.group(),this.ngcPopText=this.ngcPopText||this.add.group(),this.ngcPopLabel=this.ngcPopLabel||this.add.group(),t="grid populated".toUpperCase(),i=[],this.ngcPLX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcPLY=Math.floor(140),this.getIndices(t,i),this.typeText(t,i,this.ngcPLX,this.ngcPLY,this.ngLabelScale,"ngcPopLabel",!1,null,0),this.ngcPopulations=[];for(var e=0;e<.95;e+=.05)this.ngcPopulations.push((Math.round(100*e)/100).toFixed(2));blocks.populated="0.40",t=blocks.populated.toUpperCase(),i=[],this.ngcPTX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcPTY=Math.floor(170+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcPTX,this.ngcPTY,this.ngTextScale,"ngcPopText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcPLAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcPLAY=Math.floor(170),this.getIndices(t,i),this.typeText(t,i,this.ngcPLAX,this.ngcPLAY,this.ngLabelScale,"ngcPL","ngcPL",this.leftArrow("ngcPopulations","populated","ngcPTX","ngcPTY","ngTextScale","ngcPopText","left"),2e3),t=">".toUpperCase(),i=[],this.ngcPRAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcPRAY=Math.floor(170),this.getIndices(t,i),this.typeText(t,i,this.ngcPRAX,this.ngcPRAY,this.ngLabelScale,"ngcPR","ngcPR",this.rightArrow("ngcPopulations","populated","ngcPTX","ngcPTY","ngTextScale","ngcPopText","left"),2e3),this.ngcNL=this.ngcNL||this.add.group(),this.ngcNR=this.ngcNR||this.add.group(),this.ngcNeutText=this.ngcNeutText||this.add.group(),this.ngcNeutLabel=this.ngcNeutLabel||this.add.group(),t="neutral blocks count".toUpperCase(),i=[],this.ngcNLX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcNLY=Math.floor(140),this.getIndices(t,i),this.typeText(t,i,this.ngcNLX,this.ngcNLY,this.ngLabelScale,"ngcNeutLabel",!1,null,0),this.ngcNeutrals=[];for(var e=1;e<41;e++)this.ngcNeutrals.push(String(e));blocks.centerBlocksCount="1",t=blocks.centerBlocksCount.toUpperCase(),i=[],this.ngcNTX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcNTY=Math.floor(170+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcNTX,this.ngcNTY,this.ngTextScale,"ngcNeutText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcNLAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcNLAY=Math.floor(170),this.getIndices(t,i),this.typeText(t,i,this.ngcNLAX,this.ngcNLAY,this.ngLabelScale,"ngcNL","ngcNL",this.leftArrow("ngcNeutrals","centerBlocksCount","ngcNTX","ngcNTY","ngTextScale","ngcNeutText","right"),2e3),t=">".toUpperCase(),i=[],this.ngcNRAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcNRAY=Math.floor(170),this.getIndices(t,i),this.typeText(t,i,this.ngcNRAX,this.ngcNRAY,this.ngLabelScale,"ngcNR","ngcNR",this.rightArrow("ngcNeutrals","centerBlocksCount","ngcNTX","ngcNTY","ngTextScale","ngcNeutText","right"),2e3),this.ngcCL=this.ngcCL||this.add.group(),this.ngcCR=this.ngcCR||this.add.group(),this.ngcChainText=this.ngcChainText||this.add.group(),this.ngcChainLabel=this.ngcChainLabel||this.add.group(),t="chain length".toUpperCase(),i=[],this.ngcCLX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcCLY=Math.floor(210),this.getIndices(t,i),this.typeText(t,i,this.ngcCLX,this.ngcCLY,this.ngLabelScale,"ngcChainLabel",!1,null,0),this.ngcChains=[];for(var e=1;e<37;e++)this.ngcChains.push(String(e));blocks.chainLengthMin="3",t=blocks.chainLengthMin.toUpperCase(),i=[],this.ngcCTX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcCTY=Math.floor(240+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcCTX,this.ngcCTY,this.ngTextScale,"ngcChainText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcCLAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcCLAY=Math.floor(240),this.getIndices(t,i),this.typeText(t,i,this.ngcCLAX,this.ngcCLAY,this.ngLabelScale,"ngcCL","ngcCL",this.leftArrow("ngcChains","chainLengthMin","ngcCTX","ngcCTY","ngTextScale","ngcChainText","left"),2e3),t=">".toUpperCase(),i=[],this.ngcCRAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcCRAY=Math.floor(240),this.getIndices(t,i),this.typeText(t,i,this.ngcCRAX,this.ngcCRAY,this.ngLabelScale,"ngcCR","ngcCR",this.rightArrow("ngcChains","chainLengthMin","ngcCTX","ngcCTY","ngTextScale","ngcChainText","left"),2e3),this.ngcRL=this.ngcBL||this.add.group(),this.ngcRR=this.ngcBR||this.add.group(),this.ngcRestText=this.ngcRestText||this.add.group(),this.ngcRestLabel=this.ngcRestLabel||this.add.group(),t="max number".toUpperCase(),i=[],this.ngcBLX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcBLY=Math.floor(210),this.getIndices(t,i),this.typeText(t,i,this.ngcBLX,this.ngcBLY,this.ngLabelScale,"ngcRestLabel",!1,null,0),this.ngcNumbers=[];for(var e=9;e<37;e++)this.ngcNumbers.push(String(e));blocks.blockRestrictions="9",t=blocks.blockRestrictions.toUpperCase(),i=[],this.ngcRTX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcRTY=Math.floor(240+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcRTX,this.ngcRTY,this.ngTextScale,"ngcRestText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcRLAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcRLAY=Math.floor(240),this.getIndices(t,i),this.typeText(t,i,this.ngcRLAX,this.ngcRLAY,this.ngLabelScale,"ngcRL","ngcRL",this.leftArrow("ngcNumbers","ngcNumbers","ngcRTX","ngcRTY","ngTextScale","ngcRestText","right"),2e3),t=">".toUpperCase(),i=[],this.ngcRRAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcRRAY=Math.floor(240),this.getIndices(t,i),this.typeText(t,i,this.ngcRRAX,this.ngcRRAY,this.ngLabelScale,"ngcRR","ngcRR",this.rightArrow("ngcNumbers","ngcNumbers","ngcRTX","ngcRTY","ngTextScale","ngcRestText","right"),2e3),this.ngcPAL=this.ngcPAL||this.add.group(),this.ngcPAR=this.ngcPAR||this.add.group(),this.ngcParText=this.ngcParText||this.add.group(),this.ngcParLabel=this.ngcParLabel||this.add.group(),t="only odd numbers".toUpperCase(),i=[],this.ngcPaLX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcPaLY=Math.floor(280),this.getIndices(t,i),this.typeText(t,i,this.ngcPaLX,this.ngcPaLY,this.ngLabelScale,"ngcParLabel",!1,null,0),this.ngcParities=["no","yes"],blocks.ngcParity="no",t=blocks.ngcParity.toUpperCase(),i=[],this.ngcPaTX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcPaTY=Math.floor(310+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcPaTX,this.ngcPaTY,this.ngTextScale,"ngcParText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcPaLAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcPaLAY=Math.floor(310),this.getIndices(t,i),this.typeText(t,i,this.ngcPaLAX,this.ngcPaLAY,this.ngLabelScale,"ngcPAL","ngcPAL",this.leftArrow("ngcParities","ngcParity","ngcPaTX","ngcPaTY","ngTextScale","ngcParText","left"),2e3),t=">".toUpperCase(),i=[],this.ngcPaRAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcPaRAY=Math.floor(310),this.getIndices(t,i),this.typeText(t,i,this.ngcPaRAX,this.ngcPaRAY,this.ngLabelScale,"ngcPAR","ngcPAR",this.rightArrow("ngcParities","ngcParity","ngcPaTX","ngcPaTY","ngTextScale","ngcParText","left"),2e3),this.ngcTtaAL=this.ngcTtaAL||this.add.group(),this.ngcTtaAR=this.ngcTtaAR||this.add.group(),this.ngcActTimText=this.ngcActTimText||this.add.group(),this.ngcActTimLabel=this.ngcActTimLabel||this.add.group(),t="time per turn on/off".toUpperCase(),
i=[],this.ngcTtaLX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcTtaLY=Math.floor(280),this.getIndices(t,i),this.typeText(t,i,this.ngcTtaLX,this.ngcTtaLY,this.ngLabelScale,"ngcActTimLabel",!1,null,0),this.ngcTurnTimers=["on","off"],blocks.ngcTurnTimer="off",t=blocks.ngcTurnTimer.toUpperCase(),i=[],this.ngcTtaTX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcTtaTY=Math.floor(310+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcTtaTX,this.ngcTtaTY,this.ngTextScale,"ngcActTimText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcTtaLAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTtaLAY=Math.floor(310),this.getIndices(t,i),this.typeText(t,i,this.ngcTtaLAX,this.ngcTtaLAY,this.ngLabelScale,"ngcTtaAL","ngcTtaAL",this.leftArrow("ngcTurnTimers","ngcTurnTimer","ngcTtaTX","ngcTtaTY","ngTextScale","ngcActTimText","right"),2e3),t=">".toUpperCase(),i=[],this.ngcTtaRAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTtaRAY=Math.floor(310),this.getIndices(t,i),this.typeText(t,i,this.ngcTtaRAX,this.ngcTtaRAY,this.ngLabelScale,"ngcTtaAR","ngcTtaAR",this.rightArrow("ngcTurnTimers","ngcTurnTimer","ngcTtaTX","ngcTtaTY","ngTextScale","ngcActTimText","right"),2e3),this.ngcTtdAL=this.ngcTtdAL||this.add.group(),this.ngcTtdAR=this.ngcTtdAR||this.add.group(),this.ngcActDecText=this.ngcActDecText||this.add.group(),this.ngcActDecLabel=this.ngcActDecLabel||this.add.group(),t="time decrease on/off".toUpperCase(),i=[],this.ngcTtdLX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcTtdLY=Math.floor(350),this.getIndices(t,i),this.typeText(t,i,this.ngcTtdLX,this.ngcTtdLY,this.ngLabelScale,"ngcActDecLabel",!1,null,0),this.ngcTurnTimersDec=["on","off"],blocks.ngctimeDecreaseActive="on",t=blocks.ngctimeDecreaseActive.toUpperCase(),i=[],this.ngcTtdTX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcTtdTY=Math.floor(380+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcTtdTX,this.ngcTtdTY,this.ngTextScale,"ngcActDecText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcTtdLAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTtdLAY=Math.floor(380),this.getIndices(t,i),this.typeText(t,i,this.ngcTtdLAX,this.ngcTtdLAY,this.ngLabelScale,"ngcTtdAL","ngcTtdAL",this.leftArrow("ngcTurnTimersDec","ngctimeDecreaseActive","ngcTtdTX","ngcTtdTY","ngTextScale","ngcActDecText","left"),2e3),t=">".toUpperCase(),i=[],this.ngcTtdRAX=Math.floor(this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTtdRAY=Math.floor(380),this.getIndices(t,i),this.typeText(t,i,this.ngcTtdRAX,this.ngcTtdRAY,this.ngLabelScale,"ngcTtdAR","ngcTtdAR",this.rightArrow("ngcTurnTimersDec","ngctimeDecreaseActive","ngcTtdTX","ngcTtdTY","ngTextScale","ngcActDecText","left"),2e3),this.ngcTtAL=this.ngcTtAL||this.add.group(),this.ngcTtAR=this.ngcTtAR||this.add.group(),this.ngcTurnTimeText=this.ngcTurnTimeText||this.add.group(),this.ngcTurnTimeLabel=this.ngcTurnTimeLabel||this.add.group(),t="turn time [sec]".toUpperCase(),i=[],this.ngcTtLX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2),this.ngcTtLY=Math.floor(350),this.getIndices(t,i),this.typeText(t,i,this.ngcTtLX,this.ngcTtLY,this.ngLabelScale,"ngcTurnTimeLabel",!1,null,0),this.ngcTurnTimes=[];for(var e=2;e<21;e++)this.ngcTurnTimes.push(String(e));blocks.ngcTurnTime="1",t=blocks.ngcTurnTime.toUpperCase(),i=[],this.ngcTtTX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngTextScale/2),this.ngcTtTY=Math.floor(380+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcTtTX,this.ngcTtTY,this.ngTextScale,"ngcTurnTimeText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcTtLAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTtLAY=Math.floor(380),this.getIndices(t,i),this.typeText(t,i,this.ngcTtLAX,this.ngcTtLAY,this.ngLabelScale,"ngcTtAL","ngcTtAL",this.leftArrow("ngcTurnTimes","ngcTurnTime","ngcTtTX","ngcTtTY","ngTextScale","ngcTurnTimeText","right"),2e3),t=">".toUpperCase(),i=[],this.ngcTtRAX=Math.floor(2*this.game.width/3-this.getTextLength(t)*this.blockSize*this.ngLabelScale/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTtRAY=Math.floor(380),this.getIndices(t,i),this.typeText(t,i,this.ngcTtRAX,this.ngcTtRAY,this.ngLabelScale,"ngcTtAR","ngcTtAR",this.rightArrow("ngcTurnTimes","ngcTurnTime","ngcTtTX","ngcTtTY","ngTextScale","ngcTurnTimeText","right"),2e3),this.ngcTTDtAL=this.ngcTTDtAL||this.add.group(),this.ngcTTDtAR=this.ngcTTDtAR||this.add.group(),this.ngcTurnDtText=this.ngcTurnDtText||this.add.group(),this.ngcTurnDtLabel=this.ngcTurnDtLabel||this.add.group(),t="turn time decrease [sec]".toUpperCase(),i=[],this.ngcTTDtLX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngcTTDtLY=Math.floor(420),this.getIndices(t,i),this.typeText(t,i,this.ngcTTDtLX,this.ngcTTDtLY,this.ngLabelScale,"ngcTurnDtLabel",!1,null,0),this.ngcTurnTimeDts=[];for(var e=1;e<21;e++)this.ngcTurnTimeDts.push(String(e));blocks.ngcTurnTimeDt="1",t=blocks.ngcTurnTimeDt.toUpperCase(),i=[],this.ngcTTDtTX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngTextScale)/2),this.ngcTTDtTY=Math.floor(450+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcTTDtTX,this.ngcTTDtTY,this.ngTextScale,"ngcTurnDtText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcTTDtLAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTTDtLAY=Math.floor(450),this.getIndices(t,i),this.typeText(t,i,this.ngcTTDtLAX,this.ngcTTDtLAY,this.ngLabelScale,"ngcTTDtAL","ngcTTDtAL",this.leftArrow("ngcTurnTimeDts","ngcTurnTimeDt","ngcTTDtTX","ngcTTDtTY","ngTextScale","ngcTurnDtText",!1),2e3),t=">".toUpperCase(),i=[],this.ngcTTDtRAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTTDtRAY=Math.floor(450),this.getIndices(t,i),this.typeText(t,i,this.ngcTTDtRAX,this.ngcTTDtRAY,this.ngLabelScale,"ngcTTDtAR","ngcTTDtAR",this.rightArrow("ngcTurnTimeDts","ngcTurnTimeDt","ngcTTDtTX","ngcTTDtTY","ngTextScale","ngcTurnDtText",!1),2e3),this.ngcTpAL=this.ngcTpAL||this.add.group(),this.ngcTpAR=this.ngcTpAR||this.add.group(),this.ngcTurnPText=this.ngcTurnPText||this.add.group(),this.ngcTurnPLabel=this.ngcTurnPLabel||this.add.group(),t="decrease time rate [sec]".toUpperCase(),i=[],this.ngcTpLX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngcTpLY=Math.floor(490),this.getIndices(t,i),this.typeText(t,i,this.ngcTpLX,this.ngcTpLY,this.ngLabelScale,"ngcTurnPLabel",!1,null,0),this.ngcTimeSteps=[];for(var e=1;e<41;e++)this.ngcTimeSteps.push(String(e));blocks.ngcTimeStep="30",t=blocks.ngcTimeStep.toUpperCase(),i=[],this.ngcTpTX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngTextScale)/2),this.ngcTpTY=Math.floor(520+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcTpTX,this.ngcTpTY,this.ngTextScale,"ngcTurnPText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcTpLAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTpLAY=Math.floor(520),this.getIndices(t,i),this.typeText(t,i,this.ngcTpLAX,this.ngcTpLAY,this.ngLabelScale,"ngcTpAL","ngcTpAL",this.leftArrow("ngcTimeSteps","ngcTimeStep","ngcTpTX","ngcTpTY","ngTextScale","ngcTurnPText",!1),2e3),t=">".toUpperCase(),i=[],this.ngcTpRAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTpRAY=Math.floor(520),this.getIndices(t,i),this.typeText(t,i,this.ngcTpRAX,this.ngcTpRAY,this.ngLabelScale,"ngcTpAR","ngcTpAR",this.rightArrow("ngcTimeSteps","ngcTimeStep","ngcTpTX","ngcTpTY","ngTextScale","ngcTurnPText",!1),2e3),this.ngcTmAL=this.ngcTmAL||this.add.group(),this.ngcTmAR=this.ngcTmAR||this.add.group(),this.ngcTMText=this.ngcTMText||this.add.group(),this.ngcTMLabel=this.ngcTMLabel||this.add.group(),t="min time per turn [sec]".toUpperCase(),i=[],this.ngcTmLX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2),this.ngcTmLY=Math.floor(560),this.getIndices(t,i),this.typeText(t,i,this.ngcTmLX,this.ngcTmLY,this.ngLabelScale,"ngcTMLabel",!1,null,0),this.ngcTimeMins=[];for(var e=2;e<10.1;e+=.5)this.ngcTimeMins.push((Math.round(10*e)/10).toFixed(1));blocks.ngcTimeMin="3.0",t=blocks.ngcTimeMin.toUpperCase(),i=[],this.ngcTmTX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngTextScale)/2),this.ngcTmTY=Math.floor(590+(5*this.blockSize*this.ngLabelScale-5*this.blockSize*this.ngTextScale)/2),this.getIndices(t,i),this.typeText(t,i,this.ngcTmTX,this.ngcTmTY,this.ngTextScale,"ngcTMText",!1,null,0),t="<".toUpperCase(),i=[],this.ngcTmLAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2-this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTmLAY=Math.floor(590),this.getIndices(t,i),this.typeText(t,i,this.ngcTmLAX,this.ngcTmLAY,this.ngLabelScale,"ngcTmAL","ngcTmAL",this.leftArrow("ngcTimeMins","ngcTimeMin","ngcTmTX","ngcTmTY","ngTextScale","ngcTMText",!1),2e3),t=">".toUpperCase(),i=[],this.ngcTmRAX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*this.ngLabelScale)/2+this.getTextLength("normal".toUpperCase())*this.blockSize*this.ngLabelScale),this.ngcTmRAY=Math.floor(590),this.getIndices(t,i),this.typeText(t,i,this.ngcTmRAX,this.ngcTmRAY,this.ngLabelScale,"ngcTmAR","ngcTmAR",this.rightArrow("ngcTimeMins","ngcTimeMin","ngcTmTX","ngcTmTY","ngTextScale","ngcTMText",!1),2e3),this.ngcSelect=this.ngcSelect||this.add.group(),t="select".toUpperCase(),i=[],this.ngcSelectX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*1.5*this.ngLabelScale)/2),this.ngcSelectY=Math.floor(650),this.ngcSelectDummy=this.ngcSelectDummy||this.add.image(this.ngcSelectX,this.ngcSelectY,"dummy"),this.ngcSelectDummy.width=this.getTextLength(t)*this.blockSize*1.5*this.ngLabelScale,this.ngcSelectDummy.height=5*this.blockSize*1.5*this.ngLabelScale,this.ngcSelectDummy.renderable=!1,this.ngcSelectDummy.inputEnabled=!1,this.ngcSelectDummy.events.onInputDown.add(function(){this.destroyCustomMenu(),this.destroyNewGame(),this.state.start("game")},this),this.getIndices(t,i),this.typeText(t,i,this.ngcSelectX,this.ngcSelectY,1.5*this.ngLabelScale,"ngcSelect","ngcSelectDummy",null,0),this.ngcReturn=this.ngcReturn||this.add.group(),t="return".toUpperCase(),i=[],this.ngcReturnX=Math.floor((this.game.width-this.getTextLength(t)*this.blockSize*1.5*this.ngLabelScale)/2),this.ngcReturnY=Math.floor(690),this.ngcReturnDummy=this.ngcReturnDummy||this.add.image(this.ngcReturnX,this.ngcReturnY,"dummy"),this.ngcReturnDummy.width=this.getTextLength(t)*this.blockSize*1.5*this.ngLabelScale,this.ngcReturnDummy.height=5*this.blockSize*1.5*this.ngLabelScale,this.ngcReturnDummy.renderable=!1,this.ngcReturnDummy.inputEnabled=!1,this.ngcReturnDummy.events.onInputDown.add(function(){blocks.ngCustom=!1,this.ngcReturnDummy.renderable=!1,this.ngcReturnDummy.inputEnabled=!1,this.ngcReturnDummy.events.onInputDown.removeAll(),this.ngcSelectDummy.renderable=!1,this.ngcSelectDummy.inputEnabled=!1,this.ngcSelectDummy.events.onInputDown.removeAll();for(var t=0;t<this.ngcGroups.length;t++)this.ngcGroups[t].callAll("kill"),this.ngcGroups[t].callAll("events.onInputDown.removeAll","events.onInputDown"),this.ngcGroups[t].setAll("inputEnabled",!1);this.newGame()},this),this.getIndices(t,i),this.typeText(t,i,this.ngcReturnX,this.ngcReturnY,1.5*this.ngLabelScale,"ngcReturn","ngcReturnDummy",null,0),this.ngcGroups=[this.ngcML,this.ngcMR,this.ngcMText,this.ngcMLabel,this.ngcSL,this.ngcSR,this.ngcSText,this.ngcSLabel,this.ngcPL,this.ngcPR,this.ngcPopText,this.ngcPopLabel,this.ngcNL,this.ngcNR,this.ngcNeutText,this.ngcNeutLabel,this.ngcCL,this.ngcCR,this.ngcChainText,this.ngcChainLabel,this.ngcRL,this.ngcRR,this.ngcRestText,this.ngcRestLabel,this.ngcPAL,this.ngcPAR,this.ngcParText,this.ngcParLabel,this.ngcTtaAL,this.ngcTtaAR,this.ngcActTimText,this.ngcActTimLabel,this.ngcTtdAL,this.ngcTtdAR,this.ngcActDecText,this.ngcActDecLabel,this.ngcTtAL,this.ngcTtAR,this.ngcTurnTimeText,this.ngcTurnTimeLabel,this.ngcTTDtAL,this.ngcTTDtAR,this.ngcTurnDtText,this.ngcTurnDtLabel,this.ngcTpAL,this.ngcTpAR,this.ngcTurnPText,this.ngcTurnPLabel,this.ngcTmAL,this.ngcTmAR,this.ngcTMText,this.ngcTMLabel,this.ngcReturn,this.ngcSelect]},destroyCustomMenu:function(){this.ngcReturnDummy.inputEnabled=!1,this.ngcReturnDummy.events.onInputDown.removeAll(),this.ngcSelectDummy.inputEnabled=!1,this.ngcSelectDummy.events.onInputDown.removeAll(),this.ngcReturnDummy.destroy(),this.ngcSelectDummy.destroy(),this.ngcReturnDummy=void 0,this.ngcSelectDummy=void 0;for(var t=0;t<this.ngcGroups.length;t++)this.ngcGroups[t].callAll("events.onInputDown.removeAll","events.onInputDown"),this.ngcGroups[t].setAll("inputEnabled",!1),this.ngcGroups[t].destroy(!0),this.ngcGroups[t]=void 0;this.ngcML=void 0,this.ngcMR=void 0,this.ngcMText=void 0,this.ngcMLabel=void 0,this.ngcSL=void 0,this.ngcSR=void 0,this.ngcSText=void 0,this.ngcSLabel=void 0,this.ngcPL=void 0,this.ngcPR=void 0,this.ngcPopText=void 0,this.ngcPopLabel=void 0,this.ngcNL=void 0,this.ngcNR=void 0,this.ngcNeutText=void 0,this.ngcNeutLabel=void 0,this.ngcCL=void 0,this.ngcCR=void 0,this.ngcChainText=void 0,this.ngcChainLabel=void 0,this.ngcRL=void 0,this.ngcRR=void 0,this.ngcRestText=void 0,this.ngcRestLabel=void 0,this.ngcPAL=void 0,this.ngcPAR=void 0,this.ngcParText=void 0,this.ngcParLabel=void 0,this.ngcTtaAL=void 0,this.ngcTtaAR=void 0,this.ngcActTimText=void 0,this.ngcActTimLabel=void 0,this.ngcTtdAL=void 0,this.ngcTtdAR=void 0,this.ngcActDecText=void 0,this.ngcActDecLabel=void 0,this.ngcTtAL=void 0,this.ngcTtAR=void 0,this.ngcTurnTimeText=void 0,this.ngcTurnTimeLabel=void 0,this.ngcTTDtAL=void 0,this.ngcTTDtAR=void 0,this.ngcTurnDtText=void 0,this.ngcTurnDtLabel=void 0,this.ngcTpAL=void 0,this.ngcTpAR=void 0,this.ngcTurnPText=void 0,this.ngcTurnPLabel=void 0,this.ngcTmAL=void 0,this.ngcTmAR=void 0,this.ngcTMText=void 0,this.ngcTMLabel=void 0,this.ngcReturn=void 0,this.ngcSelect=void 0},getTextLength:function(t){for(var i=0,e=0;e<t.length;e++)i+="W"!==t[e]?4:6;return i},getIndices:function(t,i){for(var e=0;e<t.length;e++)i.push(e)},typeText:function(t,i,e,s,h,o,n,a,l){if(0===i.length)return void(o===n?this.game.time.events.add(l,function(){this[o].setAll("inputEnabled",!0),this[o].callAll("events.onInputDown.add","events.onInputDown",a)},this):n!==!1&&this.game.time.events.add(l,function(){this[n].inputEnabled=!0},this));var c=i.splice(this.rnd.integerInRange(0,i.length-1),1),r=t[c];if(" "!==r){for(var g=0,d=0;d<c;d++)g+="W"!==t[d]?this.blockSize*h*4:this.blockSize*h*6;for(var u=[],d=0;d<this.alphabet[r].length;d++)for(var m=0;m<this.alphabet[r][d].length;m++)u.push([this.alphabet[r][d][m],d]);for(var p;;){if(0===u.length)break;p=u.splice(this.rnd.integerInRange(0,u.length-1),1);var b=this.addBlock(l,!1,!0,p,e+g,s,h,o);b>l&&(l=b)}}this.game.time.events.add(50,function(){l-=50,this.typeText(t,i,e,s,h,o,n,a,l)},this)},addBlock:function(t,i,e,s,h,o,n,a){var l,c=this.rnd.integerInRange(1,36),r=this.directions[this.rnd.integerInRange(0,3)],g=this.blockSize;if(!i&&e!==!0)for(var d=this.imageBufferGroup,u=[],m=this.rnd.integerInRange(1,6),p=0;p<m;p++)l=d.getFirstDead(),l?(l.alive=!0,u.push(l)):u.push(!1);if(i){if(0===this.chainsTitle.length)return t;l=!1,c=this.number;var b=this.chainsTitle.splice(this.rnd.integerInRange(0,this.chainsTitle.length-1),1)}switch(e===!0&&(c=this.number,g*=n,l=this[a].getFirstDead(),b=s),r){case"top":var T=e===!0?h+g*b[0][0]:this.rnd.integerInRange(0,this.game.width-g),f=this.game.height,k=!1,v=-6*g;break;case"down":var T=e===!0?h+g*b[0][0]:this.rnd.integerInRange(0,this.game.width-g),f=-g,k=!1,v=this.game.height+6*g;break;case"right":var T=-g,f=e===!0?o+g*b[0][1]:this.rnd.integerInRange(0,this.game.height-g),k=this.game.width+6*g,v=!1;break;case"left":var T=this.game.width,f=e===!0?o+g*b[0][1]:this.rnd.integerInRange(0,this.game.height-g),k=-6*g,v=!1}if(i?(k=this.titlePaddingX+g*b[0][0],v=this.titlePaddingY+g*b[0][1]):e===!0&&(k=h+g*b[0][0],v=o+g*b[0][1]),i&&!l?(l=this.titleGroup.getFirstDead(),l.key="block"+blocks.padNumber(c),l.loadTexture(l.key),l.reset(T,f)):e!==!0||l?(i&&l||e===!0&&l)&&(l.key="block"+blocks.padNumber(c),l.loadTexture(l.key),l.reset(T,f)):l=this.add.image(T,f,"block"+blocks.padNumber(c),0,this[a]),!i&&e!==!0)for(var S=0===this.rnd.integerInRange(0,1)?this.imageGroup:this.imageGroup2,p=0;p<u.length;p++){if(c=this.rnd.integerInRange(1,36),u[p])if(d.remove(u[p]),S.add(u[p]),0===p)switch(r){case"top":u[p].key="block"+blocks.padNumber(c),u[p].loadTexture(u[p].key),u[p].reset(T,f+p*this.blockSize);break;case"down":u[p].key="block"+blocks.padNumber(c),u[p].loadTexture(u[p].key),u[p].reset(T,f-p*this.blockSize);break;case"right":u[p].key="block"+blocks.padNumber(c),u[p].loadTexture(u[p].key),u[p].reset(T-p*this.blockSize,f);break;case"left":u[p].key="block"+blocks.padNumber(c),u[p].loadTexture(u[p].key),u[p].reset(T+p*this.blockSize,f)}else{switch(u[p].key="block"+blocks.padNumber(c),u[p].loadTexture(u[p].key),u[p].alive=!0,u[p].exists=!0,u[p].visible=!0,u[p].renderable=!0,r){case"top":u[p].x=0,u[p].y=p*this.blockSize;break;case"down":u[p].x=0,u[p].y=-p*this.blockSize;break;case"right":u[p].x=-p*this.blockSize,u[p].y=0;break;case"left":u[p].x=p*this.blockSize,u[p].y=0}u[0].addChild(u[p])}else if(0===p)switch(r){case"top":u[p]=this.add.image(T,f+p*this.blockSize,"block"+blocks.padNumber(c),0,S);break;case"down":u[p]=this.add.image(T,f-p*this.blockSize,"block"+blocks.padNumber(c),0,S);break;case"right":u[p]=this.add.image(T-p*this.blockSize,f,"block"+blocks.padNumber(c),0,S);break;case"left":u[p]=this.add.image(T+p*this.blockSize,f,"block"+blocks.padNumber(c),0,S)}else switch(r){case"top":u[0].addChild(this.game.add.image(0,p*this.blockSize,"block"+blocks.padNumber(c),0,S));break;case"down":u[0].addChild(this.game.add.image(0,-p*this.blockSize,"block"+blocks.padNumber(c),0,S));break;case"right":u[0].addChild(this.game.add.image(-p*this.blockSize,0,"block"+blocks.padNumber(c),0,S));break;case"left":u[0].addChild(this.game.add.image(p*this.blockSize,0,"block"+blocks.padNumber(c),0,S))}var x="bold 25px Times New Roman",w={font:x,fill:"#ffffff",wordWrap:!0,wordWrapWidth:this.blockSize,align:"center"},L=this.add.text(0,0,c,w);switch(L.setScaleMinMax(0,1),L.anchor.set(.5),L.smoothed=!1,L.name="label",r){case"top":L.x=Math.floor(u[0].width/2),L.y=Math.floor(p*this.blockSize+u[0].height/2+2);break;case"down":L.x=Math.floor(u[0].width/2),L.y=Math.floor(-p*this.blockSize+u[0].height/2+2);break;case"right":L.x=Math.floor(-p*this.blockSize+u[0].width/2),L.y=Math.floor(u[0].height/2+2);break;case"left":L.x=Math.floor(p*this.blockSize+u[0].width/2),L.y=Math.floor(u[0].height/2+2)}u[0].addChild(L)}e===!0&&l.scale.set(n);var M=this.rnd.integerInRange(5e3,15e3);return i?M=this.rnd.integerInRange(1e3,1200):e===!0&&(M=n<.2?this.rnd.integerInRange(800,1e3):this.rnd.integerInRange(1500,2500)),M>t&&(t=M),k===!1?u[0].tween=this.add.tween(u[0]).to({y:v},M):v===!1?u[0].tween=this.add.tween(u[0]).to({x:k},M):l.tween=this.add.tween(l).to({x:k,y:v},M),i||e===!0?i&&(this.titleTimer=this.game.time.events.add(100,function(){t-=100,this.addBlock(t,!0)},this)):u[0].tween.onComplete.add(this.tweenFn,this),i||e===!0?l.tween.start():u[0].tween.start(),t},tweenFn:function(t){t.kill();for(var i=t.removeChildren(0,t.children.length),e=0;e<i.length;e++)"label"===i[e].name?i[e].destroy():(i[e].kill(),this.imageBufferGroup.add(i[e]));t.parent.remove(t),this.imageBufferGroup.add(t)}};var blocks=blocks||{};blocks.game=function(t){},blocks.game.prototype={},blocks.game.prototype={moveBlock:function(){if(this.controlsActive&&!this.forceTurn)if("top"===this.direction||"bottom"===this.direction){if(this.cursor.left.isDown&&this.controlsUp.left||this.cursor.right.isDown&&this.controlsUp.right){if(this.cursor.left.isDown){if(this.activeBlock.image.x-this.controlsVelocity<this.limits.horizontal.min)return;var t=-1,i="-"}else if(this.cursor.right.isDown){if(this.activeBlock.image.x+this.activeBlock.image.width+this.controlsVelocity>this.limits.horizontal.max)return;var t=1,i="+"}this.controlsActive=!1,this.moveTimer=Date.now(),this.prevCol=this.activeColumn,this.activeColumn+=t,this.vls.tween=this.add.tween(this.vls).to({x:i+this.controlsVelocity},this.controlsTweenTime),this.vls.tween.start(),this.activeBlock.tween=this.add.tween(this.activeBlock.image).to({x:i+this.controlsVelocity},this.controlsTweenTime),this.activeBlock.tween.onComplete.add(this.controlsOn,this),this.activeBlock.tween.start()}}else if(("right"===this.direction||"left"===this.direction)&&(this.cursor.up.isDown&&this.controlsUp.up||this.cursor.down.isDown&&this.controlsUp.down)){if(this.cursor.up.isDown){if(this.activeBlock.image.y-this.controlsVelocity<this.limits.vertical.min)return;var t=-1,i="-"}else if(this.cursor.down.isDown){if(this.activeBlock.image.y+this.activeBlock.image.height+this.controlsVelocity>this.limits.vertical.max)return;var t=1,i="+"}this.controlsActive=!1,this.moveTimer=Date.now(),this.prevRow=this.activeRow,this.activeRow+=t,this.hls.tween=this.add.tween(this.hls).to({y:i+this.controlsVelocity},this.controlsTweenTime),this.hls.tween.start(),this.activeBlock.tween=this.add.tween(this.activeBlock.image).to({y:i+this.controlsVelocity},this.controlsTweenTime),this.activeBlock.tween.onComplete.add(this.controlsOn,this),this.activeBlock.tween.start()}},moveBlocksTetris:function(){if(this.controlsActive&&this.spaceBarReleased&&!this.forceTurn)if("top"===this.direction||"bottom"===this.direction){if(this.cursor.left.isDown&&this.controlsUp.left||this.cursor.right.isDown&&this.controlsUp.right){if(this.cursor.left.isDown){for(var t=0;t<this.activeBlocks.length;t++)if(this.activeBlocks[t].image.x-this.controlsVelocity<this.limits.horizontal.min)return;var i=-1,e="-"}else if(this.cursor.right.isDown){for(var t=0;t<this.activeBlocks.length;t++)if(this.activeBlocks[t].image.x+this.activeBlocks[t].image.width+this.controlsVelocity>this.limits.horizontal.max)return;var i=1,e="+"}this.controlsActive=!1,this.moveTimer=Date.now(),this.prevCol=this.activeColumn,this.activeColumn+=i,this.vls.tween=this.add.tween(this.vls).to({x:e+this.controlsVelocity},this.controlsTweenTime),this.vls.tween.start();for(var t=0;t<this.activeBlocks.length;t++)this.activeBlocks[t].tween=this.add.tween(this.activeBlocks[t].image).to({x:e+this.controlsVelocity},this.controlsTweenTime),this.activeBlocks[t].tween.onComplete.add(this.controlsOn,this),this.activeBlocks[t].tween.start()}}else if(("right"===this.direction||"left"===this.direction)&&(this.cursor.up.isDown&&this.controlsUp.up||this.cursor.down.isDown&&this.controlsUp.down)){if(this.cursor.up.isDown){for(var t=0;t<this.activeBlocks.length;t++)if(this.activeBlocks[t].image.y-this.controlsVelocity<this.limits.vertical.min)return;var i=-1,e="-"}else if(this.cursor.down.isDown){for(var t=0;t<this.activeBlocks.length;t++)if(this.activeBlocks[t].image.y+this.activeBlocks[t].image.height+this.controlsVelocity>this.limits.vertical.max)return;var i=1,e="+"}this.controlsActive=!1,this.moveTimer=Date.now(),this.prevRow=this.activeRow,this.activeRow+=i,this.hls.tween=this.add.tween(this.hls).to({y:e+this.controlsVelocity},this.controlsTweenTime),this.hls.tween.start();for(var t=0;t<this.activeBlocks.length;t++)this.activeBlocks[t].tween=this.add.tween(this.activeBlocks[t].image).to({y:e+this.controlsVelocity},this.controlsTweenTime),this.activeBlocks[t].tween.onComplete.add(this.controlsOn,this),this.activeBlocks[t].tween.start()}},pushBlockToField:function(){if(this.controlsActive)if("top"===this.direction||"bottom"===this.direction){if(this.forceTurn||this.cursor.down.isDown&&this.controlsUp.down&&"top"===this.direction||this.cursor.up.isDown&&this.controlsUp.up&&"bottom"===this.direction){if("top"===this.direction&&this.cursor.down.isDown||"top"===this.direction&&this.forceTurn){var t=!0,i=this.checkField(!1,this.activeColumn,t);if(i===!1&&this.forceTurn){var e=this.findLastValidPosition(!0,!1,t,this.activeColumn,this.activeRow);i=e[0],this.activeColumn=e[1],this.activeRow=e[2]}var s=Math.floor(this.blockVelocity*(i+1)/this.rows),h="top",o="right"}else if("bottom"===this.direction&&this.cursor.up.isDown||"bottom"===this.direction&&this.forceTurn){var t=!1,i=this.checkField(!1,this.activeColumn,t);if(i===!1&&this.forceTurn){var e=this.findLastValidPosition(!0,!1,t,this.activeColumn,this.activeRow);i=e[0],this.activeColumn=e[1],this.activeRow=e[2]}var s=Math.floor(this.blockVelocity*(this.rows-i)/this.rows),h="bottom",o="left"}var n=this.testIndexBounds(!1,i);if(n)return this.activeBlock.image.alpha=.65,void this.gameOver();if(i===!1)return;this.controlsActive=!1,this.prevCol=!1,this.turnTimerActive&&this.sideRectTween.stop(),this.changeDirection(),this.blockControlsOnKeyDown();var a=this.activeBlock,l=this.forceTurn;this.forceTurn=!1,this.activeBlock.tween=this.add.tween(this.activeBlock.image).to({y:this.topBarHeight+this.paddingY+this.blockSize*i},s),this.activeBlock.tween.onComplete.add(function(){this.addBlockToField(a,i,this.activeColumn);var t=[];t=this.findChains(this.field),this.lastChain=t.length/2,this.lastChain>this.longestChain&&(this.longestChain=this.lastChain),this.popLastChainMsg();this.destroyBlocks(t);this.updateScoreText(),this.resetActiveRowColum(),this.updateBuffer(h),this.blockAddition=!0,this.updateSums(),l&&this.onKeyUp(),this.controlsActive=!0,this.setTurnTimer()},this),this.activeBlock.tween.start(),this.updateActiveBlock(this.activeBlock,o)}}else if(("right"===this.direction||"left"===this.direction)&&(this.forceTurn||this.cursor.left.isDown&&this.controlsUp.left&&"right"===this.direction||this.cursor.right.isDown&&this.controlsUp.right&&"left"===this.direction)){if("right"===this.direction&&this.cursor.left.isDown||"right"===this.direction&&this.forceTurn){var t=!1,i=this.checkField(this.activeRow,!1,t);if(i===!1&&this.forceTurn){var e=this.findLastValidPosition(!1,!0,t,this.activeColumn,this.activeRow);i=e[0],this.activeColumn=e[1],this.activeRow=e[2]}var s=Math.floor(this.blockVelocity*(this.columns-i)/this.columns),h="right",o="bottom"}else if("left"===this.direction&&this.cursor.right.isDown||"left"===this.direction&&this.forceTurn){var t=!0,i=this.checkField(this.activeRow,!1,t);if(i===!1&&this.forceTurn){var e=this.findLastValidPosition(!1,!0,t,this.activeColumn,this.activeRow);i=e[0],this.activeColumn=e[1],this.activeRow=e[2]}var s=Math.floor(this.blockVelocity*(i+1)/this.columns),h="left",o="top"}var n=this.testIndexBounds(!0,i);if(n)return void this.gameOver();if(i===!1)return;this.controlsActive=!1,this.prevRow=!1,this.turnTimerActive&&this.sideRectTween.stop(),this.changeDirection(),this.blockControlsOnKeyDown();var a=this.activeBlock,l=this.forceTurn;this.forceTurn=!1,this.activeBlock.tween=this.add.tween(this.activeBlock.image).to({x:this.paddingX+this.blockSize*i},s),this.activeBlock.tween.onComplete.add(function(){this.addBlockToField(a,this.activeRow,i);var t=[];t=this.findChains(this.field),this.lastChain=t.length/2,this.lastChain>this.longestChain&&(this.longestChain=this.lastChain),this.popLastChainMsg();this.destroyBlocks(t);this.updateScoreText(),this.resetActiveRowColum(),this.updateBuffer(h),this.blockAddition=!0,this.updateSums(),l&&this.onKeyUp(),this.controlsActive=!0,this.setTurnTimer()},this),this.activeBlock.tween.start(),this.updateActiveBlock(this.activeBlock,o)}},updateGuidesBMD:function(){var t,i;switch(this.direction){case"top":i=Math.max.apply(null,this.tetrisBlockSets[this.currentSets.top].x),t=Math.min.apply(null,this.tetrisBlockSets[this.currentSets.top].x),this.vlBMD.clear(),this.vlBMD.ctx.fillStyle="#ff0000",this.vlBMD.ctx.fillRect((t+1)*this.blockSize,0,1,this.game.height-2*this.paddingY),this.vlBMD.ctx.fillRect((i+2)*this.blockSize-1,0,1,this.game.height-2*this.paddingY);break;case"right":i=Math.max.apply(null,this.tetrisBlockSets[this.currentSets.right].x),t=Math.min.apply(null,this.tetrisBlockSets[this.currentSets.right].x),this.hlBMD.clear(),this.hlBMD.ctx.fillStyle="#ff0000",this.hlBMD.ctx.fillRect(0,this.guideWidth-(t+1)*this.blockSize-1,this.game.width-2*this.paddingX,1),this.hlBMD.ctx.fillRect(0,this.guideWidth-(i+2)*this.blockSize,this.game.width-2*this.paddingX,1);break;case"bottom":i=Math.max.apply(null,this.tetrisBlockSets[this.currentSets.bottom].x),t=Math.min.apply(null,this.tetrisBlockSets[this.currentSets.bottom].x),this.vlBMD.clear(),this.vlBMD.ctx.fillStyle="#ff0000",this.vlBMD.ctx.fillRect((t+1)*this.blockSize,0,1,this.game.height-2*this.paddingY),this.vlBMD.ctx.fillRect((i+2)*this.blockSize-1,0,1,this.game.height-2*this.paddingY);break;case"left":i=Math.max.apply(null,this.tetrisBlockSets[this.currentSets.left].x),t=Math.min.apply(null,this.tetrisBlockSets[this.currentSets.left].x),this.hlBMD.clear(),this.hlBMD.ctx.fillStyle="#ff0000",this.hlBMD.ctx.fillRect(0,this.guideWidth-(t+1)*this.blockSize-1,this.game.width-2*this.paddingX,1),this.hlBMD.ctx.fillRect(0,this.guideWidth-(i+2)*this.blockSize,this.game.width-2*this.paddingX,1)}},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},newPositions:function(t,i,e){var s,h,o,n,a,l,c,r,g,d=!1,u=!0;switch(this.direction){case"top":s=[this.activeColumn-1,-1];break;case"right":s=[this.columns-1,this.activeRow-1];break;case"bottom":s=[this.activeColumn-1,this.rows-1];break;case"left":s=[-1,this.activeRow-1]}for("top"===this.direction||"bottom"===this.direction?(o=this.activeColumn>this.prevCol?-1:1,h=this.activeColumn,n=this.rows,a=this.columns,l=0,c=1):(o=this.activeRow>this.prevRow?-1:1,h=this.activeRow,n=this.columns,a=this.rows,l=1,c=0);d===!1;){if(u=!0,"top"===this.direction||"left"===this.direction)t:for(var m=-1;m<n;m++){for(var p=0;p<t.length;p++){if(r=m+t[p][c],g=h-1+t[p][l],g<0||g>=a)break t;if(r<0){s="top"===this.direction?[h-1,r]:[r,h-1];continue t}if(r>n-1){s="out";break t}if("top"===this.direction&&this.field[r][g].alive||"left"===this.direction&&this.field[g][r].alive){u=!1;break t}}s="top"===this.direction?[h-1,m]:[m,h-1]}else t:for(var m=n-1;m>=-1;m--){for(var p=0;p<t.length;p++){if(r=m+t[p][c],g=h-1+t[p][l],g<0||g>=a)break t;if(r>n-1){s="bottom"===this.direction?[h-1,r]:[r,h-1];continue t}if(r<0){s="out";break t}if("bottom"===this.direction&&this.field[r][g].alive||"right"===this.direction&&this.field[g][r].alive){u=!1;break t}}s="bottom"===this.direction?[h-1,m]:[m,h-1]}if(!this.forceTurn)break;u||("top"===this.direction||"bottom"===this.direction?(this.activeColumn=h,this.vls.x=(this.activeColumn-1)*this.blockSize+this.paddingX):(this.activeRow=h,this.hls.y=(this.activeRow-1)*this.blockSize+this.paddingY+this.topBarHeight),d=!0),h+=o,(h<0||h>=a)&&(o*=-1,h="top"===this.direction||"bottom"===this.direction?this.activeColumn:this.activeRow);
}return s},popLastChainMsg:function(){if(0!==this.lastChain){var t={font:"70px Times New Roman",fill:"rgb(199, 0, 100)"},i=this.game.add.text(this.game.width/2,this.topBarHeight+(this.game.height-this.topBarHeight)/2,this.lastChain+"x",t);i.anchor.y=.5,i.anchor.x=.5;var e=this.add.tween(i.scale).to({x:1.5,y:1.5},350);e.onComplete.add(function(){i.destroy()},this),e.start()}},pushBlocksToFieldTetris:function(){if(this.controlsActive&&this.spaceBarReleased)if("top"===this.direction||"bottom"===this.direction){if(this.forceTurn||this.cursor.down.isDown&&this.controlsUp.down&&"top"===this.direction||this.cursor.up.isDown&&this.controlsUp.up&&"bottom"===this.direction){if(this.pushingBlocks=!0,"top"===this.direction&&this.cursor.down.isDown||"top"===this.direction&&this.forceTurn){for(var t,i=[],e={1:!1,2:!1},s=0;s<this.activeBlocks.length;s++)t=[],t=this.activeBlocks[s].image.x<this.paddingX+this.activeColumn*this.blockSize-this.blockSize/2?[0,void 0]:this.activeBlocks[s].image.x>this.paddingX+this.activeColumn*this.blockSize+this.blockSize/2?[2,void 0]:[1,void 0],this.activeBlocks[s].image.y<this.topBarHeight+this.blockSize?(t[1]=0,e[1]=!0):(t[1]=1,e[2]=!0),t.push(s),i.push(t);var h=this.newPositions(i,t,e),o="top",n="right"}else if("bottom"===this.direction&&this.cursor.up.isDown||"bottom"===this.direction&&this.forceTurn){for(var t,i=[],e={1:!1,2:!1},s=0;s<this.activeBlocks.length;s++)t=[],t=this.activeBlocks[s].image.x<this.paddingX+this.activeColumn*this.blockSize-this.blockSize/2?[0,void 0]:this.activeBlocks[s].image.x>this.paddingX+this.activeColumn*this.blockSize+this.blockSize/2?[2,void 0]:[1,void 0],this.activeBlocks[s].image.y<this.topBarHeight+this.paddingY+this.rows*this.blockSize+this.blockSize/2?(t[1]=0,e[2]=!0):(t[1]=1,e[1]=!0),t.push(s),i.push(t);var h=this.newPositions(i,t,e),o="bottom",n="left"}if("out"===h)return void(this.pushingBlocks=!1);if("top"===this.direction&&h[1]<0||"bottom"===this.direction&&h[1]>=this.rows-1){for(var a,l,c=!1,s=0;s<i.length;s++)if(a=h[0]+i[s][0],l=h[1]+i[s][1],"top"===this.direction&&l<0||"bottom"===this.direction&&l>=this.rows||"top"===this.direction&&this.field[l][a].alive||"bottom"===this.direction&&this.field[l][a].alive){c=!0;break}if(c){if(this.quit===!1){var r,a,l,g,d;this.controlsActive=!1;for(var s=0;s<this.activeBlocks.length;s++)r=this.activeBlocks[s],"top"===this.direction?(l=0,g=Math.floor(this.blockVelocity/this.rows),d="+"):(l=this.rows-2,g=Math.floor(this.blockVelocity/this.rows),d="-"),a=h[0]+i[s][0],this.activeBlocks[s].image.x=a*this.blockSize+this.paddingX,this.activeBlocks[s].tween=this.add.tween(this.activeBlocks[s].image).to({y:d+this.blockSize},g),this.add.tween(this.activeBlocks[s].image).to({alpha:.65},g).start(),s===this.activeBlocks.length-1&&this.activeBlocks[s].tween.onComplete.add(function(){this.gameOver()},this),this.activeBlocks[s].tween.start();this.quit=!0}return}}for(var g,u=-1,s=0;s<i.length&&(u=h[1]+i[s][1],!(u>=0&&u<this.rows));s++);g="top"===this.direction?Math.floor((u+1)/this.rows*this.blockVelocity):Math.floor((this.rows-u)/this.rows*this.blockVelocity),this.controlsActive=!1,this.prevCol=!1,this.turnTimerActive&&this.sideRectTween.stop(),this.changeDirection(),this.blockControlsOnKeyDown();var r=this.activeBlocks,m=this.forceTurn;this.forceTurn=!1,this.buffer[o]=[];for(var l,a,p=!1,s=0;s<this.activeBlocks.length;s++)r=this.activeBlocks[s],l=h[1]+i[s][1],a=h[0]+i[s][0],this.activeBlocks[s].image.x=this.paddingX+this.blockSize*a,this.activeBlocks[s].tween=this.add.tween(this.activeBlocks[s].image).to({y:this.topBarHeight+this.paddingY+this.blockSize*l},g),1===this.activeBlocks.length&&(p=!0),s===this.activeBlocks.length-1?this.activeBlocks[s].tween.onComplete.add(function(){this.addBlockToField(r,l,a);var t=[];t=this.findChains(this.field),this.lastChain=t.length/2,this.lastChain>this.longestChain&&(this.longestChain=this.lastChain),this.popLastChainMsg();this.destroyBlocks(t);this.updateScoreText(),this.resetActiveRowColum(),this.updateBuffer(o),this.blockAddition=!0,m&&this.onKeyUp(),p&&(this.pushingBlocks=!1),this.controlsActive=!0,this.setTurnTimer()},this):this.activeBlocks[s].tween.onComplete.add(function(t,i,e){this.addBlockToField(t,i,e),this.pushingBlocks=!1}.bind(this,r,l,a),this),this.activeBlocks[s].tween.start();this.updateActiveBlock(this.activeBlocks,n),this.updateGuidesBMD()}}else if(("right"===this.direction||"left"===this.direction)&&(this.forceTurn||this.cursor.left.isDown&&this.controlsUp.left&&"right"===this.direction||this.cursor.right.isDown&&this.controlsUp.right&&"left"===this.direction)){if(this.pushingBlocks=!0,"right"===this.direction&&this.cursor.left.isDown||"right"===this.direction&&this.forceTurn){for(var t,i=[],e={1:!1,2:!1},s=0;s<this.activeBlocks.length;s++)t=[],t=this.activeBlocks[s].image.y<this.topBarHeight+this.paddingY+this.activeRow*this.blockSize?[void 0,0]:this.activeBlocks[s].image.y>this.topBarHeight+this.paddingY+this.activeRow*this.blockSize+this.blockSize/2?[void 0,2]:[void 0,1],this.activeBlocks[s].image.x<this.paddingX+this.columns*this.blockSize+this.blockSize/2?(t[0]=0,e[2]=!0):(t[0]=1,e[1]=!0),t.push(s),i.push(t);var h=this.newPositions(i,t,e),o="right",n="bottom"}else if("left"===this.direction&&this.cursor.right.isDown||"left"===this.direction&&this.forceTurn){for(var t,i=[],e={1:!1,2:!1},s=0;s<this.activeBlocks.length;s++)t=[],t=this.activeBlocks[s].image.y<this.topBarHeight+this.paddingY+this.activeRow*this.blockSize?[void 0,0]:this.activeBlocks[s].image.y>this.topBarHeight+this.paddingY+this.activeRow*this.blockSize+this.blockSize/2?[void 0,2]:[void 0,1],this.activeBlocks[s].image.x<this.blockSize/2?(t[0]=0,e[1]=!0):(t[0]=1,e[2]=!0),t.push(s),i.push(t);var h=this.newPositions(i,t,e),o="left",n="top"}if("out"===h)return void(this.pushingBlocks=!1);if("left"===this.direction&&h[0]<0||"right"===this.direction&&h[0]>=this.columns-1){for(var a,l,c=!1,s=0;s<i.length;s++)if(a=h[0]+i[s][0],l=h[1]+i[s][1],"left"===this.direction&&a<0||"right"===this.direction&&a>=this.columns||"left"===this.direction&&this.field[l][a].alive||"right"===this.direction&&this.field[l][a].alive){c=!0;break}if(c){if(this.quit===!1){var r,a,l,g,d;this.controlsActive=!1;for(var s=0;s<this.activeBlocks.length;s++)r=this.activeBlocks[s],"left"===this.direction?(a=0,g=Math.floor(this.blockVelocity/this.columns),d="+"):(a=this.columns-2,g=Math.floor(this.blockVelocity/this.columns),d="-"),l=h[1]+i[s][1],this.activeBlocks[s].image.y=l*this.blockSize+this.topBarHeight+this.paddingY,this.activeBlocks[s].tween=this.add.tween(this.activeBlocks[s].image).to({x:d+this.blockSize},g),this.add.tween(this.activeBlocks[s].image).to({alpha:.65},g).start(),s===this.activeBlocks.length-1&&this.activeBlocks[s].tween.onComplete.add(function(){this.gameOver()},this),this.activeBlocks[s].tween.start();this.quit=!0}return}}for(var g,u=-1,s=0;s<i.length&&(u=h[0]+i[s][0],!(u>=0&&u<this.columns));s++);g="left"===this.direction?Math.floor((u+1)/this.columns*this.blockVelocity):Math.floor((this.columns-u)/this.columns*this.blockVelocity),this.controlsActive=!1,this.prevCol=!1,this.turnTimerActive&&this.sideRectTween.stop(),this.changeDirection(),this.blockControlsOnKeyDown();var r=this.activeBlocks,m=this.forceTurn;this.forceTurn=!1,this.buffer[o]=[];for(var l,a,p=!1,s=0;s<this.activeBlocks.length;s++)r=this.activeBlocks[s],l=h[1]+i[s][1],a=h[0]+i[s][0],this.activeBlocks[s].image.y=this.topBarHeight+this.paddingY+this.blockSize*l,this.activeBlocks[s].tween=this.add.tween(this.activeBlocks[s].image).to({x:this.paddingX+this.blockSize*a},g),1===this.activeBlocks.length&&(p=!0),s===this.activeBlocks.length-1?this.activeBlocks[s].tween.onComplete.add(function(){this.addBlockToField(r,l,a);var t=[];t=this.findChains(this.field),this.lastChain=t.length/2,this.lastChain>this.longestChain&&(this.longestChain=this.lastChain),this.popLastChainMsg();this.destroyBlocks(t);this.updateScoreText(),this.resetActiveRowColum(),this.updateBuffer(o),this.blockAddition=!0,m&&this.onKeyUp(),p&&(this.pushingBlocks=!1),this.controlsActive=!0,this.setTurnTimer()},this):this.activeBlocks[s].tween.onComplete.add(function(t,i,e){this.addBlockToField(t,i,e),this.pushingBlocks=!1}.bind(this,r,l,a),this),this.activeBlocks[s].tween.start();this.updateActiveBlock(this.activeBlocks,n),this.updateGuidesBMD()}},addBlock:function(t,i){var e=this.imageGroup.getFirstDead();e?(e.key="block"+blocks.padNumber(i),e.name=i,e.loadTexture(e.key),e.scale.setTo(this.scaleFactor),e.reset(t.x,t.y)):(e=this.add.image(t.x,t.y,"block"+blocks.padNumber(i),0,this.imageGroup),e.name=i,e.scale.setTo(this.scaleFactor));var s=25,h=0;this.rows>21?(s=36,h=1):21===this.rows?s=30:19===this.rows&&(s=28);var o="bold "+s*this.scaleFactor+"px Times New Roman",n={font:o,fill:"#ffffff",wordWrap:!0,wordWrapWidth:this.blockSize,align:"center"},a=this.add.text(0,0,i,n);return a.setScaleMinMax(0,1),a.anchor.set(.5),a.x=Math.floor(e.width/(2*this.scaleFactor)),a.y=Math.floor(e.height/(2*this.scaleFactor)+2+h),a.smoothed=!1,e.addChild(a),e},destroyBlocks:function(t){if(t.length>0){for(var i=0;i<t.length;i+=2){var e=this.field[t[i+1]][t[i]];"tetris"===t.gameMode&&this.tetrisRemoveNumber(e.value),e.tween=this.add.tween(e.image).to({x:e.image.x+e.image.width/2,y:e.image.y+e.image.height/2},this.blockDestroyTweenTime,"Linear"),e.tween.onComplete.add(this.destroyBlocksTween,this);var s=this.add.tween(e.image.scale).to({x:this.blockDestroyScale,y:this.blockDestroyScale},this.blockDestroyTweenTime,"Linear"),h=this.overlayImageGroup.getFirstDead();if(h)h.renderable=!0,h.scale.x=1,h.scale.y=1,h.alpha=.65,h.reset(e.image.x,e.image.y);else{var o=this.game.add.bitmapData(this.blockSize,this.blockSize);o.ctx.fillStyle="rgba(199, 0, 100, 0.65)",o.ctx.fillRect(0,0,this.blockSize,this.blockSize),h=o.addToWorld(e.image.x,e.image.y),this.overlayImageGroup.add(h)}h.tween1=this.add.tween(h).to({x:e.image.x+e.image.width/2,y:e.image.y+e.image.height/2},this.blockDestroyTweenTime,"Linear"),h.tween1.onComplete.add(function(){h.renderable=!1},this),h.tween2=this.add.tween(h.scale).to({x:this.blockDestroyScale,y:this.blockDestroyScale},this.blockDestroyTweenTime,"Linear"),e.tween.start(),s.start(),h.tween1.start(),h.tween2.start(),e.alive=!1,e.image=null,e.tween=null}return!0}return!1},destroyBlocksTween:function(t,i){var e=t.getChildAt(0);e.destroy(),t.kill()},sumTwoBlocks:function(){if(this.blockAddition&&this.controlsActive&&"tetris"!==blocks.gameMode&&this.spaceBar.isDown){switch(this.blockAddition=!1,this.direction){case"top":if(this.activeBlock.value>18||this.buffer.right.value>18)return;var t=this.activeBlock.value+this.buffer.right.value;this.buffer.right.image.kill(),this.buffer.right.image.getChildAt(0).destroy(),this.updateBuffer("right"),this.buffer.top.value=t,this.updateSums();break;case"right":if(this.activeBlock.value>18||this.buffer.bottom.value>18)return;var t=this.activeBlock.value+this.buffer.bottom.value;this.buffer.bottom.image.kill(),this.buffer.bottom.image.getChildAt(0).destroy(),this.updateBuffer("bottom"),this.buffer.right.value=t,this.updateSums();break;case"bottom":if(this.activeBlock.value>18||this.buffer.left.value>18)return;var t=this.activeBlock.value+this.buffer.left.value;this.buffer.left.image.kill(),this.buffer.left.image.getChildAt(0).destroy(),this.updateBuffer("left"),this.buffer.bottom.value=t,this.updateSums();break;case"left":if(this.activeBlock.value>18||this.buffer.top.value>18)return;var t=this.activeBlock.value+this.buffer.top.value;this.buffer.top.image.kill(),this.buffer.top.image.getChildAt(0).destroy(),this.updateBuffer("top"),this.buffer.left.value=t,this.updateSums()}this.activeBlock.image.kill(),this.activeBlock.image.getChildAt(0).destroy(),this.activeBlock={value:t,start:this.activeBlock.start,image:this.addBlock({x:this.activeBlock.image.x,y:this.activeBlock.image.y},t),tween:null}}},blockControlsOnKeyDown:function(){this.controlsUp.up=!1,this.controlsUp.right=!1,this.controlsUp.down=!1,this.controlsUp.left=!1},onKeyUp:function(){switch(this.direction){case"top":this.controlsUp.down=!0,this.controlsUp.left=!0,this.controlsUp.right=!0;break;case"bottom":this.controlsUp.up=!0,this.controlsUp.right=!0,this.controlsUp.left=!0;break;case"right":this.controlsUp.left=!0,this.controlsUp.up=!0,this.controlsUp.down=!0;break;case"left":this.controlsUp.right=!0,this.controlsUp.down=!0,this.controlsUp.up=!0}},updateScoreText:function(){var t="SCORE: "+this.score;this.scoreText.text=t},menu:function(){this.state.start("menu")},pause:function(){this.game.paused||(this.pauseScreen.renderable=!0,this.game.paused=!0)},unpause:function(){this.game.paused&&(this.pauseScreen.renderable=!1,this.game.paused=!1)},onKeyDown:function(){this.game.paused&&!this.gameover?this.unpause():this.game.paused&&this.gameover&&this.spaceBar.isDown&&(this.game.paused=!1,this.state.start("game"))},gameOver:function(){return this.gameover=!0,this.updateGameOverScreen(),this.gameOverBMD.addToWorld(Math.floor(this.game.width/2-this.goW/2),Math.floor(this.game.height/2-this.goH/2)),this.game.paused=!0,!0},createGameOverScreen:function(){this.goW=Math.floor(this.game.width/2),this.goH=Math.floor(this.game.height/3),this.gameOverBMD=this.add.bitmapData(this.goW,this.goH),this.gameOverBMD.ctx.fillStyle="#e5308b",this.gameOverBMD.ctx.fillRect(0,0,this.goW,this.goH),this.gameOverBMD.ctx.fillStyle="#e5308b",this.gameOverBMD.ctx.fillRect(1,1,this.goW-2,this.goH-2),this.gameOverBMD.ctx.fillStyle="#ffffff",this.gameOverBMD.ctx.fillRect(1,this.goH-57,this.goW-2,56)},updateGameOverScreen:function(){this.bestScore=window.sessionStorage.getItem("bestScore"),null===this.bestScore?(this.bestScore=this.score,window.sessionStorage.setItem("bestScore",String(this.bestScore))):this.bestScore<this.score&&(this.bestScore=this.score,window.sessionStorage.setItem("bestScore",String(this.bestScore)));var t="SCORE: "+this.score,i=this.game.make.text(0,0,t,{font:"28px Times New Roman",fill:"#ffffff"});i.anchor.setTo(.5),i.smoothed=!1,this.gameOverBMD.draw(i,Math.floor(this.goW/2),50);var e="BEST SCORE: "+this.bestScore;i=this.game.make.text(0,0,e,{font:"28px Times New Roman",fill:"#ffffff"}),i.anchor.setTo(.5),i.smoothed=!1,this.gameOverBMD.draw(i,Math.floor(this.goW/2),100);var s="LONGEST CHAIN: "+this.longestChain;i=this.game.make.text(0,0,s,{font:"28px Times New Roman",fill:"#ffffff"}),i.anchor.setTo(.5),i.smoothed=!1,this.gameOverBMD.draw(i,Math.floor(this.goW/2),150),i=this.game.make.text(0,0,"PRESS SPACE TO TRY AGAIN",{font:"25px Times New Roman",fill:"#c70064"}),i.anchor.setTo(.5),i.smoothed=!1,this.gameOverBMD.draw(i,Math.floor(this.goW/2),this.goH-28)},testIndexBounds:function(t,i){return t?i<0||i>=this.columns:i<0||i>=this.rows},findLastValidPosition:function(t,i,e,s,h,o,n,a,l){if(t){for(var c=!1,r=s>this.prevCol?-1:1,g=s;c===!1;)g+=r,(g<0||g>=this.columns)&&(r*=-1,g=s),c=this.checkField(!1,g,e);return s=g,this.vls.x=s*this.blockSize+this.paddingX,this.vls.tween.stop(),this.activeBlock.image.x=s*this.activeBlock.image.width+this.paddingX,this.activeBlock.tween.stop(),this.controlsOn(),[c,s,h]}if(i){for(var c=!1,r=h>this.prevRow?-1:1,d=h;c===!1;)d+=r,(d<0||d>=this.rows)&&(r*=-1,d=h),c=this.checkField(d,!1,e);return h=d,this.hls.y=h*this.activeBlock.image.height+this.topBarHeight+this.paddingY,this.hls.tween.stop(),this.activeBlock.image.y=h*this.activeBlock.image.height+this.topBarHeight+this.paddingY,this.activeBlock.tween.stop(),this.controlsOn(),[c,s,h]}},turnTimerFn:function(){if(this.timeDecreaseActive){if(this.turnTime-=this.turnTimeDt,this.turnTimeRedTime-=this.turnTimeRedTimeDt,this.turnTimeRedTime<=0&&(this.turnTimeRedTime=0),this.turnTime<=this.turnTimeMin)return this.turnTime=this.turnTimeMin,void(this.timeDecreaseActive=!1);this.turnTimer=this.game.time.create(!1),this.turnTimer.loop(this.turnTimeRedTime,this.turnTimerFn,this),this.turnTimer.start()}},changeSideTetris:function(){if(this.controlsActive&&this.spaceBar.isDown&&!this.forceTurn&&this.spaceBarReleased&&!this.game.pause){this.onKeyUp(),this.spaceBarReleased=!1,this.resetActiveRowColum();for(var t=0;t<this.activeBlocks.length;t++)"top"===this.direction||"bottom"===this.direction?this.activeBlocks[t].image.x=this.paddingX+(this.activeColumn+this.tetrisBlockSets[this.currentSets[this.direction]].x[t])*this.blockSize:this.activeBlocks[t].image.y=this.paddingY+this.topBarHeight+(this.activeRow-this.tetrisBlockSets[this.currentSets[this.direction]].x[t])*this.blockSize;this.changeDirection(),this.resetActiveRowColum(),this.setTurnTimer(!0),this.activateIndicatingRect(),this.updateActiveBlock(this.activeBlocks,this.direction),this.updateGuidesBMD()}},updateSums:function(){"tetris"!==blocks.gameMode&&(this.sums.tr.val=this.buffer.top.value>18||this.buffer.right.value>18?this.buffer.top.value:this.buffer.top.value+this.buffer.right.value,this.sums.br.val=this.buffer.right.value>18||this.buffer.bottom.value>18?this.buffer.right.value:this.buffer.right.value+this.buffer.bottom.value,this.sums.bl.val=this.buffer.bottom.value>18||this.buffer.left.value>18?this.buffer.bottom.value:this.buffer.bottom.value+this.buffer.left.value,this.sums.tl.val=this.buffer.left.value>18||this.buffer.top.value>18?this.buffer.left.value:this.buffer.left.value+this.buffer.top.value,this.sums.tr.text.text=this.sums.tr.val,this.sums.br.text.text=this.sums.br.val,this.sums.bl.text.text=this.sums.bl.val,this.sums.tl.text.text=this.sums.tl.val)},setTurnTimer:function(t){var i,e,s;switch(this.direction){case"top":i=t===!0?this.leftRect.alpha:1,s=this.topRect,this.rightRect.alpha=1,this.botRect.alpha=1,this.leftRect.alpha=1;break;case"right":i=t===!0?this.topRect.alpha:1,s=this.rightRect,this.topRect.alpha=1,this.botRect.alpha=1,this.leftRect.alpha=1;break;case"bottom":i=t===!0?this.rightRect.alpha:1,s=this.botRect,this.topRect.alpha=1,this.rightRect.alpha=1,this.leftRect.alpha=1;break;case"left":i=t===!0?this.botRect.alpha:1,s=this.leftRect,this.topRect.alpha=1,this.rightRect.alpha=1,this.botRect.alpha=1}e=t===!0?Math.floor(i*this.turnTime):this.turnTime,s.alpha=i,this.turnTimerActive&&(t===!0&&this.sideRectTween.stop(),this.sideRectTween=this.add.tween(s).to({alpha:0},e,"Linear"),this.sideRectTween.onComplete.add(this.turnTimeFn,this),this.sideRectTween.start())},turnTimeFn:function(){this.forceTurn=!0},activateIndicatingRect:function(){switch(this.direction){case"top":this.topRect.renderable=!0,this.rightRect.renderable=!1,this.botRect.renderable=!1,this.leftRect.renderable=!1;break;case"right":this.topRect.renderable=!1,this.rightRect.renderable=!0,this.botRect.renderable=!1,this.leftRect.renderable=!1;break;case"bottom":this.topRect.renderable=!1,this.rightRect.renderable=!1,this.botRect.renderable=!0,this.leftRect.renderable=!1;break;case"left":this.topRect.renderable=!1,this.rightRect.renderable=!1,this.botRect.renderable=!1,this.leftRect.renderable=!0}},resetLinesPosition:function(){"top"===this.direction||"bottom"===this.direction?(this.hls.renderable=!1,this.vls.x=this.activeColumn*this.blockSize+this.paddingX,"tetris"===blocks.gameMode&&(this.vls.x=(this.activeColumn-1)*this.blockSize+this.paddingX),this.vls.y=this.topBarHeight+this.paddingY,this.vls.renderable=!0):"left"!==this.direction&&"right"!==this.direction||(this.vls.renderable=!1,this.hls.x=this.paddingX,this.hls.y=this.activeRow*this.blockSize+this.paddingY+this.topBarHeight,"tetris"===blocks.gameMode&&(this.hls.y=(this.activeRow-1)*this.blockSize+this.paddingY+this.topBarHeight),this.hls.renderable=!0)},resetActiveRowColum:function(){this.activeRow=Math.floor(this.rows/2),this.activeColumn=Math.floor(this.columns/2),this.resetLinesPosition()},updateActiveBlock:function(t,i){"tetris"===blocks.gameMode?this.activeBlocks=this.buffer[i]:this.activeBlock=this.buffer[i]},updateBuffer:function(t){if("tetris"===blocks.gameMode)for(var i,e,s,h={},o=this.rnd.integerInRange(0,this.tetrisBlockSets.length-1),n=this.tetrisBlockSets[o].x.length,a=this.tetrisBlockSets[o].x,l=this.tetrisBlockSets[o].y,c=0;c<n;c++){switch(h.x=this.startingPoints[t].x,h.y=this.startingPoints[t].y,t){case"top":i=a[c],e=l[c],h={x:this.startingPoints[t].x+i*this.blockSize,y:this.startingPoints[t].y-e*this.blockSize},this.currentSets.top=o;break;case"right":i=a[c],e=l[c],h={x:this.startingPoints[t].x+e*this.blockSize,y:this.startingPoints[t].y-i*this.blockSize},this.currentSets.right=o;break;case"bottom":i=a[c],e=l[c],h={x:this.startingPoints[t].x+i*this.blockSize,y:this.startingPoints[t].y+e*this.blockSize},this.currentSets.bottom=o;break;case"left":i=a[c],e=l[c],h={x:this.startingPoints[t].x-e*this.blockSize,y:this.startingPoints[t].y-i*this.blockSize},this.currentSets.left=o}s=this.tetrisGetNumber(),this.tetrisAddNumber(s),this.buffer[t].push({value:s,start:t,image:this.addBlock(h,s),tween:null})}else{var s=this.number[this.rnd.integerInRange(0,this.number.length-1)];this.buffer[t]={value:s,start:t,image:this.addBlock(this.startingPoints[t],s),tween:null}}},tetrisGetNumber:function(){var t,i,e=[];i=this.rnd.integerInRange(1,100);for(var s=1;s<=this.blockCntMx.length;s++)this.blockCntMx[s].p>=i&&e.push(s);return t=0===e.length?this.rnd.integerInRange(1,this.blockCntMx.length):e[this.rnd.integerInRange(0,e.length-1)]},tetrisAddNumber:function(t){this.blockCntMx[t].cnt++,this.blockCntMx.total++,this.tetrisUpdatePercentage()},tetrisRemoveNumber:function(t){this.blockCntMx[t].cnt--,this.blockCntMx.total--,this.tetrisUpdatePercentage()},tetrisUpdatePercentage:function(){for(var t=1;t<=this.blockCntMx.length;t++)this.blockCntMx[t].p=100-Math.floor(100*this.blockCntMx[t].cnt/this.blockCntMx.total)},changeDirection:function(){for(var t=0;t<this.directions.length;t++)if(this.direction===this.directions[t]){var i=t+1;return t===this.directions.length-1&&(i=0),void(this.direction=this.directions[i])}},getTime:function(){var t=Math.floor(this.game.time.totalElapsedSeconds()),i=t%60,e=(t-i)/60%60,s=(t-i-60*e)/3600;return[s,e,i]},addBlockToField:function(t,i,e){this.field[i][e].value=t.value,this.field[i][e].alive=!0,this.field[i][e].image=t.image,this.field[i][e].tween=null},checkField:function(t,i,e){if(t!==!1){if(e){for(var s=0;s<this.field[t].length;s++)if(this.field[t][s].alive)return s-1}else if(!e)for(var s=this.field[t].length-1;s>-1;s--)if(this.field[t][s].alive)return s+1}else if(i!==!1)if(e){for(var s=0;s<this.rows;s++)if(this.field[s][i].alive)return s-1}else if(!e)for(var s=this.rows-1;s>-1;s--)if(this.field[s][i].alive)return s+1;return!1},controlsOn:function(){this.controlsActivate=!0},findChains:function(t){for(var i={},e=[],s=0;s<this.rows;s++)for(var h=0;h<this.columns;h++)if(t[s][h].alive&&!("centerblock"===t[s][h].value||i.hasOwnProperty(h)&&i[h].hasOwnProperty(s))){this.findElementChains(i,e,t,h,s);for(var o=0;o<e.length;o+=2)for(var n=[e[o],e[o+1]-1,e[o]-1,e[o+1],e[o]+1,e[o+1],e[o],e[o+1]+1],a=0;a<n.length;a+=2)n[a]<0||n[a+1]<0||n[a]>=this.columns||n[a+1]>=this.rows||t[n[a+1]][n[a]].alive&&(i.hasOwnProperty(n[a])&&i[n[a]].hasOwnProperty(n[a+1])||t[n[a+1]][n[a]].value!==t[e[o+1]][e[o]].value+1&&t[n[a+1]][n[a]].value!==t[e[o+1]][e[o]].value-1||this.findElementChains(i,e,t,n[a],n[a+1]))}return e},findElementChains:function(t,i,e,s,h){for(var o=this.findSegments(e,s,h),n=this.connectSegments(o.mins,o.maxes),a=[],l=0;l<n.length;l++)for(var c=0;c<n[l].length;c+=2)n[l].length/2>=this.chainLengthMin&&(this.score+=Math.floor(n[l].length/2)*this.field[n[l][c+1]][n[l][c]].value,a.push(n[l][c],n[l][c+1]),t.hasOwnProperty(n[l][c])||(t[n[l][c]]={}),t[n[l][c]][n[l][c+1]]=!0);for(var r=!1,l=0;l<a.length;l+=2){for(var c=0;c<i.length;c+=2)if(a[l]===i[c]&&a[l+1]===i[c+1]){r=!0;break}r?r=!1:i.push(a[l],a[l+1])}},removeRepeatingPoints:function(t){for(var i=[],e=!1,s=0;s<t.length;s++){i[s]=[];for(var h=0;h<t[s].length;h+=2){for(var o=0;o<i[s].length;o+=2)if(t[s][h]===i[s][o]&&t[s][h+1]===i[s][o+1]){e=!0;break}e?e=!1:i[s].push(t[s][h],t[s][h+1])}}return i},connectSegments:function(t,i){for(var e=[],s=[],h=0;h<t.length;h++)for(var o=0;o<i.length;o++)e.push(t[h].concat(i[o]));return s=this.removeRepeatingPoints(e)},findSegments:function(t,i,e){var s=this.findLower(t,i,e,!1,!1),h=this.findGreater(t,i,e,!1,!1),o={mins:s,maxes:h};return o},findLower:function(t,i,e,s,h){var o=[];if(!t[e][i].alive||"centerblock"===t[e][i].value)return o;for(var n=[],a=[i,e-1,i-1,e,i+1,e,i,e+1],l=0;l<a.length;l+=2)if((i!==s||e!==h)&&!(a[l]<0||a[l+1]<0||a[l]>=this.columns||a[l+1]>=this.rows)&&t[a[l+1]][a[l]].alive&&"centerblock"!==t[a[l+1]][a[l]].value){var c=t[e][i].value,r=t[a[l+1]][a[l]].value;r===c-1&&(n=this.findLower(t,a[l],a[l+1],i,e),n.forEach(function(t){t.push(i,e)}),o=o.concat(n))}return 0===o.length&&o.push([i,e]),o},findGreater:function(t,i,e,s,h){var o=[];if(!t[e][i].alive||"centerblock"===t[e][i].value)return o;for(var n=[],a=[i,e-1,i-1,e,i+1,e,i,e+1],l=0;l<a.length;l+=2)if((i!==s||e!==h)&&!(a[l]<0||a[l+1]<0||a[l]>=this.columns||a[l+1]>=this.rows)&&t[a[l+1]][a[l]].alive&&"centerblock"!==t[a[l+1]][a[l]].value){var c=t[e][i].value,r=t[a[l+1]][a[l]].value;r===c+1&&(n=this.findGreater(t,a[l],a[l+1],i,e),n.forEach(function(t){t.push(i,e)}),o=o.concat(n))}return 0===o.length&&o.push([i,e]),o}},blocks.game.prototype.create=function(){if(this.game.time.advancedTiming=!0,this.cursor=this.input.keyboard.createCursorKeys(),this.spaceBar=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.input.keyboard.addKeyCapture([Phaser.Keyboard.UP,Phaser.Keyboard.DOWN,Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.SPACEBAR]),this.controlsUp={up:!0,right:!0,down:!0,left:!0},this.cursor.up.onUp.add(this.onKeyUp,this),this.cursor.right.onUp.add(this.onKeyUp,this),this.cursor.down.onUp.add(this.onKeyUp,this),this.cursor.left.onUp.add(this.onKeyUp,this),this.quit=!1,this.longestChain=0,this.lastChain=0,this.pushingBlocks=!1,this.spaceBarReleased=!0,blocks.ngCustom){blocks.gameMode=blocks.ngcMode,this.rows=parseFloat(blocks.size),this.columns=parseFloat(blocks.size),this.blockSize="tetris"===blocks.gameMode?Math.floor((this.game.width-2)/(this.rows+4)):Math.floor((this.game.width-2)/(this.rows+2));var t=Math.floor((this.game.width-this.rows*this.blockSize)/2);(this.game.width-2*t)/this.blockSize%1!==0&&this.blockSize--,this.populated=Number(blocks.populated),this.centerBlocksCount=Number(blocks.centerBlocksCount),this.chainLengthMin=Number(blocks.chainLengthMin),this.blockRestrictions=Number(blocks.blockRestrictions),this.parity="no"!==blocks.ngcParity,this.turnTimerActive="off"!==blocks.ngcTurnTimer,this.timeDecreaseActive="off"!==blocks.ngctimeDecreaseActive,this.turnTime=1e3*Number(blocks.ngcTurnTime),this.turnTimeDt=1e3*Number(blocks.ngcTurnTimeDt),this.turnTimeRedTime=1e3*Number(blocks.ngcTimeStep),this.turnTimeMin=1e3*Number(blocks.ngcTimeMin)}else"normal"===blocks.gameMode?(this.chainLengthMin=3,this.parity=!1,this.turnTimerActive=!0,this.timeDecreaseActive=!0,this.turnTimeMin=4e3,this.turnTimeRedTimeDt=0,"easy"===blocks.difficulty?(this.populated=0,this.blockRestrictions=9,this.centerBlocksCount=1,this.turnTime=1e4,this.turnTimeRedTime=6e4,this.turnTimeDt=1e3):"normal"===blocks.difficulty?(this.populated=.2,this.blockRestrictions=18,this.centerBlocksCount=5,this.turnTime=1e4,this.turnTimeRedTime=6e4,this.turnTimeDt=1500,this.turnTimeRedTimeDt=2e3):"challenge"===blocks.difficulty&&(this.populated=.4,this.blockRestrictions=36,this.centerBlocksCount=10,this.turnTime=1e4,this.turnTimeMin=2500,this.turnTimeRedTime=6e4,this.turnTimeDt=2e3,this.parity=!0,this.chainLengthMin=4,this.turnTimeRedTimeDt=5e3),"9x9"===blocks.size?(this.rows=9,this.columns=9,this.blockSize=Math.floor(this.game.width/(this.rows+2))):"15x15"===blocks.size?(this.rows=15,this.columns=15,this.blockSize=Math.floor(this.game.width/(this.rows+2))):"21x21"===blocks.size&&(this.rows=21,this.columns=21,this.blockSize=30)):"tetris"===blocks.gameMode&&(this.chainLengthMin=3,this.parity=!1,this.turnTimerActive=!0,this.timeDecreaseActive=!0,this.turnTimeMin=4e3,this.turnTimeRedTimeDt=0,"easy"===blocks.difficulty?(this.populated=0,this.turnTime=15e3,this.turnTimeDt=1e3,this.turnTimeRedTime=6e4):"normal"===blocks.difficulty?(this.populated=.2,this.turnTime=15e3,this.turnTimeDt=1500,this.turnTimeRedTime=6e4,this.turnTimeRedTimeDt=2e3):"challenge"===blocks.difficulty&&(this.populated=.4,this.turnTime=1e4,this.turnTimeDt=2e3,this.turnTimeRedTime=6e4,this.turnTimeRedTimeDt=5e3,this.turnTimeMin=2500,this.chainLengthMin=4),"9x9"===blocks.size?(this.blockRestrictions=6,this.centerBlocksCount=1,this.rows=9,this.columns=9,this.blockSize=Math.floor((this.game.width-2)/(this.rows+4))):"15x15"===blocks.size?(this.blockRestrictions=9,this.centerBlocksCount=3,this.rows=15,this.columns=15,this.blockSize=Math.floor((this.game.width-2)/(this.rows+4))):"21x21"===blocks.size&&(this.blockRestrictions=12,this.centerBlocksCount=5,this.rows=21,this.columns=21,this.blockSize=Math.floor((this.game.width-2)/(this.rows+4))-1));this.forceTurn=!1,this.gameover=!1,this.blockDestroyScale=0,this.blockDestroyTweenTime=500,this.field={},this.blockImageWidth=30,this.scaleFactor=this.blockSize/this.blockImageWidth,this.gameSize=this.rows*this.columns,this.controlsVelocity=this.blockSize,this.controlsTweenTime=Math.floor(120*this.scaleFactor*.8),this.blockVelocity=Math.floor(1500*this.rows/15),this.moveTimer=0,this.controlsActivate=!1,this.controlsTweenTimeFactor=this.rows>15?1.6:this.rows<15?1.2:1.35,this.topBarHeight=40,this.paddingX=Math.floor((this.game.width-this.rows*this.blockSize)/2),this.paddingY=Math.floor((this.game.height-this.topBarHeight-this.columns*this.blockSize)/2);var i={font:"28px Times New Roman",fill:"rgb(199, 0, 100)"};this.menuText=this.game.add.text(this.game.width-10,Math.floor(this.topBarHeight/2),"MENU",i),this.menuText.anchor.y=.4,this.menuText.anchor.x=1,this.menuText.inputEnabled=!0,this.menuText.events.onInputDown.add(this.menu,this);var i={font:"28px Times New Roman",fill:"rgb(199, 0, 100)"};this.pauseText=this.game.add.text(this.game.width-this.menuText.width-20,Math.floor(this.topBarHeight/2),"PAUSE |",i),this.pauseText.anchor.y=.4,this.pauseText.anchor.x=1,this.pauseText.inputEnabled=!0,this.pauseText.events.onInputDown.add(this.pause,this),this.game.input.onDown.add(this.onKeyDown,this),this.game.input.keyboard.onDownCallback=this.onKeyDown.bind(this),this.bgGridBMD=this.game.add.bitmapData(this.game.width-2*this.paddingX+2,this.game.height-this.topBarHeight-2*this.paddingY+2),this.bgGridBMD.ctx.fillStyle="#ffffff",this.bgGridBMD.ctx.fillRect(0,0,this.game.width-2*this.paddingX+2,this.game.height-this.topBarHeight-2*this.paddingY+2),this.bgGridBMD.ctx.fillStyle="rgba(0, 0, 0, 0.12)",this.bgGridBMD.ctx.fillRect(0,0,this.game.width-2*this.paddingX+2,1),this.bgGridBMD.ctx.fillRect(0,1,1,this.game.height-this.topBarHeight-2*this.paddingY),this.bgGridBMD.ctx.fillRect(this.game.width-2*this.paddingX+1,1,1,this.game.height-this.topBarHeight-2*this.paddingY),this.bgGridBMD.ctx.fillRect(0,this.game.height-this.topBarHeight-2*this.paddingY+1,this.game.width-2*this.paddingX+2,1);for(var e=0;e<this.rows;e++)for(var s=0;s<this.columns;s++)this.bgGridBMD.ctx.fillRect(s*this.blockSize+1+1,e*this.blockSize+1,this.blockSize-2,1),this.bgGridBMD.ctx.fillRect(s*this.blockSize+1+1,e*this.blockSize+this.blockSize-1+1,this.blockSize-2,1),this.bgGridBMD.ctx.fillRect(s*this.blockSize+1,e*this.blockSize+1,1,this.blockSize),this.bgGridBMD.ctx.fillRect(s*this.blockSize+this.blockSize-1+1,e*this.blockSize+1,1,this.blockSize);this.bgGridBMD.addToWorld(this.paddingX-1,this.topBarHeight+this.paddingY-1),"tetris"===blocks.gameMode?(this.guideWidth=3*this.blockSize,this.hlBMD=this.game.add.bitmapData(this.game.width-2*this.paddingX,this.guideWidth),this.hlBMD.ctx.fillStyle="#ff0000",this.hlBMD.ctx.fillRect(0,0,this.game.width-2*this.paddingX,1),this.hlBMD.ctx.fillRect(0,this.guideWidth-1,this.game.width-2*this.paddingX,1),this.vlBMD=this.game.add.bitmapData(this.guideWidth,this.game.height-this.topBarHeight-2*this.paddingY),this.vlBMD.ctx.fillStyle="#ff0000",this.vlBMD.ctx.fillRect(0,0,1,this.game.height-2*this.paddingY),this.vlBMD.ctx.fillRect(this.guideWidth-1,0,1,this.game.height-2*this.paddingY)):(this.hlBMD=this.game.add.bitmapData(this.game.width-2*this.paddingX,this.blockSize),
this.hlBMD.ctx.fillStyle="#ff0000",this.hlBMD.ctx.fillRect(0,0,this.game.width-2*this.paddingX,1),this.hlBMD.ctx.fillRect(0,this.blockSize-1,this.game.width-2*this.paddingX,1),this.vlBMD=this.game.add.bitmapData(this.blockSize,this.game.height-this.topBarHeight-2*this.paddingY),this.vlBMD.ctx.fillStyle="#ff0000",this.vlBMD.ctx.fillRect(0,0,1,this.game.height-2*this.paddingY),this.vlBMD.ctx.fillRect(this.blockSize-1,0,1,this.game.height-2*this.paddingY)),this.hls=this.hlBMD.addToWorld(0,0),this.hls.renderable=!1,this.vls=this.vlBMD.addToWorld(0,0),this.vls.renderable=!1,this.topRectBMD=this.add.bitmapData(this.game.width-2*this.paddingX,this.paddingY),this.topRectBMD.ctx.fillStyle="rgb(199, 0, 100)",this.topRectBMD.ctx.fillRect(0,0,this.game.width-2*this.paddingX,this.paddingY),this.game.cache.addBitmapData("topRect",this.topRectBMD),this.topRect=this.add.image(this.paddingX,this.topBarHeight,this.game.cache.getBitmapData("topRect")),this.topRect.renderable=!1,this.rightRectBMD=this.add.bitmapData(this.paddingX,this.game.height-this.topBarHeight-2*this.paddingY),this.rightRectBMD.ctx.fillStyle="rgb(199, 0, 100)",this.rightRectBMD.ctx.fillRect(0,0,this.paddingX,this.game.height-this.topBarHeight-2*this.paddingY),this.game.cache.addBitmapData("rightRect",this.rightRectBMD),this.rightRect=this.add.image(this.game.width-this.paddingX,this.paddingY+this.topBarHeight,this.game.cache.getBitmapData("rightRect")),this.rightRect.renderable=!1,this.botRectBMD=this.add.bitmapData(this.game.width-2*this.paddingX,this.paddingY),this.botRectBMD.ctx.fillStyle="rgb(199, 0, 100)",this.botRectBMD.ctx.fillRect(0,0,this.game.width-2*this.paddingX,this.paddingY),this.game.cache.addBitmapData("botRect",this.botRectBMD),this.botRect=this.add.image(this.paddingX,this.game.height-this.paddingY,this.game.cache.getBitmapData("botRect")),this.botRect.renderable=!1,this.leftRectBMD=this.add.bitmapData(this.paddingX,this.game.height-this.topBarHeight-2*this.paddingY),this.leftRectBMD.ctx.fillStyle="rgb(199, 0, 100)",this.leftRectBMD.ctx.fillRect(0,0,this.paddingX,this.game.height-this.topBarHeight-2*this.paddingY),this.game.cache.addBitmapData("leftRect",this.leftRectBMD),this.leftRect=this.add.image(0,this.paddingY+this.topBarHeight,this.game.cache.getBitmapData("leftRect")),this.leftRect.renderable=!1,this.sideRectTween=null;for(var h=0;h<this.rows;h++){this.field[h]=[];for(var o=0;o<this.columns;o++)this.field[h][o]={alive:!1,value:-1,image:null,tween:null}}this.centerBlock={x:Math.floor(this.rows/2),y:Math.floor(this.columns/2)},this.centerBlock.image=this.add.image(Math.floor(this.game.width/2-this.blockSize/2),Math.floor(this.topBarHeight+(this.game.height-this.topBarHeight)/2-this.blockSize/2),"centerblock"),this.centerBlock.image.scale.setTo(this.scaleFactor),this.centerBlock.value="centerblock",this.centerBlock.alive=!0,this.field[this.centerBlock.y][this.centerBlock.x]=this.centerBlock,this.imageGroup=this.add.group(),this.overlayImageGroup=this.add.group();for(var n=0;n<this.centerBlocksCount-1;){var s=this.rnd.integerInRange(1,this.columns-2),e=this.rnd.integerInRange(1,this.rows-2);if(this.field[e][s].alive!==!0){n++;var a={};a.image=this.add.image(Math.floor(this.paddingX+s*this.blockSize),Math.floor(this.topBarHeight+this.paddingY+e*this.blockSize),"centerblock"),a.image.scale.setTo(this.scaleFactor),a.value="centerblock",a.alive=!0,this.field[e][s]=a}}this.startingPoints={top:{x:Math.floor(this.game.width/2-this.blockSize/2),y:this.topBarHeight+Math.floor(this.paddingY-this.blockSize)},right:{x:Math.floor(this.game.width-this.paddingX),y:Math.floor(this.topBarHeight+(this.game.height-this.topBarHeight)/2-this.blockSize/2)},bottom:{x:Math.floor(this.game.width/2-this.blockSize/2),y:Math.floor(this.game.height-this.paddingY)},left:{x:Math.floor(this.paddingX-this.blockSize),y:Math.floor(this.topBarHeight+(this.game.height-this.topBarHeight)/2-this.blockSize/2)}},this.number=[],this.blockCntMx=Object.create(null),this.blockCntMx.total=0,this.blockCntMx.length=0;for(var h=1;h<=this.blockRestrictions;h++)this.blockCntMx[h]={cnt:0,p:100},this.blockCntMx.length++,this.parity?h%2!==0&&(this.number.push(h),h<=this.blockRestrictions/2&&this.number.push(h)):(this.number.push(h),h<=this.blockRestrictions/2&&this.number.push(h));for(var l=Math.floor(this.populated*(this.rows-2)*(this.columns-2)),c=0;;){if(c>=l)break;var s="tetris"===blocks.gameMode?this.rnd.integerInRange(2,this.columns-3):this.rnd.integerInRange(1,this.columns-2),e="tetris"===blocks.gameMode?this.rnd.integerInRange(2,this.rows-3):this.rnd.integerInRange(1,this.rows-2);if(this.field[e][s].alive!==!0||"centerblock"===this.field[e][s].value){if("centerblock"!==this.field[e][s].value){var r=this.number[this.rnd.integerInRange(0,this.number.length-1)];"tetris"===blocks.gameMode&&(this.blockCntMx[r].cnt++,this.blockCntMx.total++),this.addBlockToField({value:r,alive:!0,image:this.addBlock({x:s*this.blockSize+this.paddingX,y:e*this.blockSize+this.topBarHeight+this.paddingY},r),tween:null},e,s)}c++}}if(this.currentSets={top:void 0,right:void 0,bottom:void 0,left:void 0},"tetris"===blocks.gameMode&&"9x9"!==blocks.size?this.tetrisBlockSets=[{x:[0,0,1],y:[0,1,1]},{x:[-1,0,0],y:[1,1,0]},{x:[-1,0,0],y:[1,1,0]},{x:[0,0,1],y:[1,0,0]},{x:[0,0],y:[1,0]},{x:[0,1],y:[0,0]},{x:[-1,0,1],y:[0,0,0]},{x:[-1,0,1,-1],y:[1,1,1,0]},{x:[-1,0,1,0],y:[1,1,1,0]},{x:[-1,0,1,1],y:[1,1,1,0]},{x:[0,1,0,1],y:[1,1,0,0]},{x:[0],y:[0]},{x:[0,-1,0,1],y:[1,0,0,0]},{x:[-1,-1,0,1],y:[1,0,0,0]},{x:[1,-1,0,1],y:[1,0,0,0]},{x:[0,0,1],y:[1,0,0]},{x:[0,-1,0],y:[1,0,0]}]:this.tetrisBlockSets=[{x:[0,0,1],y:[0,1,1]},{x:[-1,0,0],y:[1,1,0]},{x:[-1,0,0],y:[1,1,0]},{x:[0,0,1],y:[1,0,0]},{x:[0,0],y:[1,0]},{x:[0,1],y:[0,0]},{x:[0],y:[0]},{x:[0,0,1],y:[1,0,0]},{x:[0,-1,0],y:[1,0,0]}],this.buffer={},"tetris"===blocks.gameMode&&(this.buffer.top=[],this.buffer.right=[],this.buffer.bottom=[],this.buffer.left=[]),this.updateBuffer("top"),this.updateBuffer("right"),this.updateBuffer("bottom"),this.updateBuffer("left"),this.directions=["top","right","bottom","left"],this.direction="top","tetris"===blocks.gameMode&&this.updateGuidesBMD(),"normal"===blocks.gameMode?(this.activeBlock=this.buffer.top,this.activeRow=Math.floor(this.rows/2),this.activeColumn=Math.floor(this.columns/2),this.prevRow=!1,this.prevCol=!1):"tetris"===blocks.gameMode&&(this.activeBlocks=this.buffer.top,this.activeRow=Math.floor(this.rows/2),this.activeColumn=Math.floor(this.columns/2),this.prevRows=!1,this.prevCols=!1),this.resetLinesPosition(),this.controlsActive=!0,this.limits={horizontal:{min:this.paddingX,max:this.game.width-this.paddingX},vertical:{min:this.paddingY+this.topBarHeight,max:this.game.height-this.paddingY}},this.score=0,this.time=0,this.blockAddition=!0,"tetris"!==blocks.gameMode){this.sums={tr:{val:0,text:null},br:{val:0,text:null},bl:{val:0,text:null},tl:{val:0,text:null}};var g="bold "+30*this.scaleFactor+"px Times New Roman",i={font:g,fill:"rgb(199, 0, 100)",wordWrap:!0,wordWrapWidth:this.blockSize,align:"center"};this.sums.tr.text=this.add.text(Math.floor(this.game.width-this.paddingX/2),Math.floor(this.topBarHeight+this.paddingY/2+3),this.sums.tr.val,i),this.sums.tr.text.anchor.set(.5),this.sums.tr.text.smoothed=!1,this.sums.br.text=this.add.text(Math.floor(this.game.width-this.paddingX/2),Math.floor(this.game.height-this.paddingY/2+4),this.sums.br.val,i),this.sums.br.text.anchor.set(.5),this.sums.br.text.smoothed=!1,this.sums.bl.text=this.add.text(Math.floor(this.paddingX/2),Math.floor(this.game.height-this.paddingY/2+4),this.sums.bl.val,i),this.sums.bl.text.anchor.set(.5),this.sums.bl.text.smoothed=!1,this.sums.tl.text=this.add.text(Math.floor(this.paddingX/2),Math.floor(this.topBarHeight+this.paddingY/2+3),this.sums.tl.val,i),this.sums.tl.text.anchor.set(.5),this.sums.tl.text.smoothed=!1,this.updateSums()}this.createGameOverScreen();var d="SCORE: "+this.score;this.scoreText=this.game.add.text(10,Math.floor(this.topBarHeight/2),d,{font:"28px Times New Roman",fill:"rgb(199, 0, 100)"}),this.scoreText.anchor.y=.4,this.pauseBMD=this.add.bitmapData(this.game.width,Math.floor(1.5*this.topBarHeight)),this.pauseBMD.ctx.fillStyle="#e5308b",this.pauseBMD.ctx.fillRect(0,0,this.pauseBMD.width,this.pauseBMD.height),this.pauseText={},this.pauseText.fl=this.game.make.text(0,0,"GAME PAUSED",{font:"28px Times New Roman",fill:"#ffffff"}),this.pauseText.fl.anchor.set(.45),this.pauseBMD.draw(this.pauseText.fl,Math.floor(this.game.width/2),Math.floor(this.topBarHeight/2)),this.pauseText.sl=this.game.make.text(0,0,"click to unpause",{font:"20px Times New Roman",fill:"#ffffff"}),this.pauseText.sl.anchor.set(.45),this.pauseBMD.draw(this.pauseText.sl,Math.floor(this.game.width/2),this.pauseBMD.height-(this.pauseBMD.height-this.pauseText.fl.height)/2),this.pauseScreen=this.pauseBMD.addToWorld(Math.floor(this.game.width/2),Math.floor(this.game.height/2),.5,.5),this.pauseScreen.renderable=!1,this.timeDecreaseActive&&(this.turnTimer=this.game.time.create(!1),this.turnTimer.loop(this.turnTimeRedTime,this.turnTimerFn,this),this.turnTimer.start()),this.turnTime!==!1&&this.setTurnTimer()},blocks.game.prototype.update=function(t){this.gameover||(this.controlsActivate===!0&&Date.now()-this.moveTimer>this.controlsTweenTime*this.controlsTweenTimeFactor&&(this.controlsActive=!0,this.controlsActivate=!1,this.moveTimer=0),"tetris"===blocks.gameMode?(this.pushingBlocks||this.pushBlocksToFieldTetris(),this.spaceBar.isDown||(this.spaceBarReleased=!0),this.changeSideTetris(),this.moveBlocksTetris()):(this.sumTwoBlocks(),this.pushBlockToField(),this.moveBlock()),this.activateIndicatingRect())},blocks.game.prototype.render=function(){};var blocks=blocks||{};blocks.phaserGame=new Phaser.Game(690,730,Phaser.AUTO,"gameDiv"),blocks.phaserGame.state.add("boot",blocks.boot),blocks.phaserGame.state.add("load",blocks.load),blocks.phaserGame.state.add("menu",blocks.menu),blocks.phaserGame.state.add("game",blocks.game),blocks.padNumber=function(t){return(t<10?"0":"")+t},blocks.phaserGame.state.start("boot");